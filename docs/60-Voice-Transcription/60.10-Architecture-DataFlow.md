# AI Platform Deployment Documentation
## 60.10 Voice + Transcription (Whisper) - Architecture & Data Flow

LAN-only runtime - POPIA-friendly - Two-VM on Proxmox (+ optional GPU ASR VM) - Ubuntu 24.04

Document Control
- Document ID: `docs/60-Voice-Transcription/60.10-Architecture-DataFlow`
- Filename: `docs/60-Voice-Transcription/60.10-Architecture-DataFlow.md`
- Version: `v1.0`
- Date: `2026-02-10`
- Owner: Choice IT / Platform Engineering + Security
- Status: Architecture Standard
- Hard requirements: LAN-only; least privilege; auditable; POPIA classification; retention enforcement
- Related docs: `60.00`, `60.20`, `60.30`, `60.40`, `60.60`, `60.70`, `30.*`

## 1. Architecture Goals
- deterministic flow from audio ingestion to ACL-safe searchable transcript
- strict trust boundaries across UI, API, worker, storage, search, and graph
- full audit trail for upload, processing, review, indexing, and purge transitions
- flexible worker placement (CPU, GPU, hybrid queue workers)

## 2. Component Map
- capture sources (approved devices/systems)
- frontend UI on AI-FRONTEND01
- Gateway/API orchestration on AI-DATA01
- Whisper ASR worker (AI-DATA01 or dedicated GPU VM)
- Nextcloud artifact storage (source of truth)
- OpenSearch indexing layer
- Knowledge Graph linkage layer and mind-map presentation
- monitoring/logging and backup evidence controls

## 3. Deployment Topologies
- Option A CPU worker on AI-DATA01 for lower-volume usage
- Option B dedicated GPU worker VM for higher throughput
- Option C hybrid queue with 1..N workers under bounded concurrency

## 4. Trust Boundaries and Classification
- Boundary A: user endpoint -> frontend
- Boundary B: frontend -> Gateway/API
- Boundary C: Gateway/API -> internal worker
- Boundary D: worker -> Nextcloud/OpenSearch through controlled paths
- Boundary E: search/graph -> UI read-only view with ACL filtering

Per-job required metadata:
- sensitivity label
- retention class
- purpose tag (recommended)
- indexing rule (immediate or review-gated)

## 5. End-to-End Flows
Default flow:
1. authenticated upload into approved intake location
2. Gateway records metadata and creates auditable upload event
3. job queued with policy tags and reviewer requirement (if any)
4. worker transcribes and writes outputs into approved locations
5. completion event emitted with references
6. review-gated jobs await decision before indexing
7. approved transcripts indexed and linked into graph
8. ACL-filtered search/mind-map consumption

Review/redaction flow:
- restricted pending-review outputs
- reviewer approve/reject with mandatory reason
- only approved output proceeds to index/graph

Batch flow:
- scheduled scans create jobs through the same policy and audit path

## 6. Failure Modes and Controls
- worker crash/restart loop -> queue growth alarms, restart/backoff, manual drain
- storage unavailability -> bounded retries, pause queue, recovery runbook
- indexing failures -> retry + dead-letter + targeted reindex
- ACL drift -> block/quarantine + corrective remap
- storage pressure -> retention purge + throttling + capacity controls
- sensitive premature indexing -> quarantine/remove + incident review

## 7. Performance and Scaling
- queue depth and concurrency are primary throughput controls
- GPU mode improves long-recording latency and isolation
- schedule batch jobs off-peak with limits
- reindex operations occur in controlled windows

## 8. Integration Contracts
Nextcloud:
- canonical source for audio/transcript/metadata artifacts
- worker scope limited to specific read/write paths

OpenSearch:
- templates include transcript, segment metadata, job metadata, ACL fields
- search results must enforce ACL inheritance

Knowledge Graph:
- nodes/edges for transcript-project-entity-document relationships
- relevance links are explainable and ACL-filtered

## 9. Evidence and Audit Mapping
- each state transition emits auditable events
- evidence packs include file refs, job IDs, review decisions, index status, purge status
- policy violations are retained as security/audit events

## 10. Acceptance Criteria
- manual upload/job orchestration works with RBAC + auditing
- worker has minimum required path permissions only
- review gate blocks indexing until approval, with mandatory rejection reasons
- searchable results are visible only after ACL checks
- operational telemetry covers queue depth, latency, failures, storage growth
