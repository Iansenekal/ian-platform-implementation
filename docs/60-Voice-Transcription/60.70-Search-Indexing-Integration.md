# AI Platform Deployment Documentation
## 60.70 Voice + Transcription - Search & Indexing Integration

LAN-only runtime - POPIA-friendly - OpenSearch + Knowledge Graph integration

Document Control
- Document ID: `docs/60-Voice-Transcription/60.70-Search-Indexing-Integration`
- Filename: `docs/60-Voice-Transcription/60.70-Search-Indexing-Integration.md`
- Version: `v1.0`
- Date: `2026-02-10`
- Owner: Platform Engineering + Search/Graph Lead
- Status: Integration Standard
- Hard requirements: ACL inheritance enforced; no search/graph leakage; review-gated indexing for sensitive classes
- Related docs: `30.*`, `02.*`, `60.30`, `60.40`, `60.50`, `60.60`

## 1. Integration Goals
- make approved transcripts discoverable without violating access boundaries
- provide explainable transcript relevance and graph linkage
- enforce policy-based indexing gates (for example review-first for restricted)
- preserve Nextcloud as source-of-truth for visibility
- support deterministic reindex and purge for operations and incident response

## 2. Indexing Eligibility Rules
- default eligibility is transcripts in `40-Final` only
- restricted class requires `indexing_mode=after_review` and `VOICE_REVIEW_APPROVED`
- `30-PendingReview` is not indexable
- `indexing_mode=never` is excluded from indexing
- ACL computation failures block indexing (fail closed)

## 3. Data Mapping: Transcript to Index Document
Recommended mapped fields:
- `recording_id`
- `project_code`
- `created_at`
- `sensitivity_label`
- `retention_class`
- `expires_at`
- `source_type`
- `language`
- `transcript_text`
- `segments`
- `acl_subjects`
- `graph_refs`
- `evidence_refs`

## 4. ACL Inheritance Model for Search
- Nextcloud permissions are authoritative
- compute `acl_subjects` at index time from effective folder/file ACL
- enforce query-time intersection of user principals and `acl_subjects`
- enforce in Gateway/Search API layer, not UI-only
- no results/no hints on ACL failure

### Snippet and highlight policy
- restricted: snippets/highlights disabled by default
- confidential: snippets only when policy allows
- unauthorized items: no snippets and no placeholders

## 5. Knowledge Graph Linkage Model for Voice
### Node types
- VoiceAsset
- Transcript
- Meeting/Event (optional)

### Edge types
- `belongs_to_project`
- `derived_from`
- `mentions_entity`
- `related_to_document`
- `same_series`

### Privacy rules
- hide transcript nodes and revealing edges when transcript is not permitted
- avoid person-identity nodes for restricted classes unless policy allows
- edge explanations for restricted classes must avoid sensitive content

## 6. Mind-Map UI Behavior for Transcripts
- voice/transcript nodes use dedicated icons
- hover shows allowed metadata and an explainable linkage reason
- click opens transcript viewer for `40-Final` items only
- relevance is explainable (project context, references, entity overlap, recency)
- hidden nodes are fully suppressed (no locked/missing placeholders)

## 7. Retention-Aware Indexing
- index records must carry `expires_at`
- purge removes storage, index, and graph references together
- evidence links can remain without retained content where policy permits

## 8. Failure Handling and Reindex Strategy
- fail closed for ACL compute or inheritance uncertainty
- dead-letter queue captures indexing failures with reason codes
- deterministic reindex by project and date range
- permission changes trigger ACL-only reindex path

## 9. Verification Checklist
1. Confirm authorized-only discovery for transcripts in Final.
2. Confirm unauthorized search returns no results and no hints.
3. Confirm restricted items are unindexed until approval event exists.
4. Confirm mind-map does not leak hidden transcript nodes/edges.
5. Confirm ACL visibility changes after Nextcloud permission updates and ACL reindex.
6. Confirm purge removes transcript from storage, OpenSearch, and Knowledge Graph.

## 10. Client Rollout Variables
- index names and environment prefixes
- snippet/highlight policy by sensitivity
- entity extraction allowlist
- reindex maintenance windows
- ACL subject format (IDs vs names)
- retention purge synchronization strategy
