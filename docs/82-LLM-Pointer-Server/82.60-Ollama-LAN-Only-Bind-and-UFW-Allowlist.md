# 82.60 LLM Pointer Server Ollama LAN-Only Bind + UFW Allowlist (AI-DATA01, AI-FRONTEND01, Admin Only)

Document ID: `docs/82-LLM-Pointer-Server/82.60-Ollama-LAN-Only-Bind-and-UFW-Allowlist`  
Version: `v1.0`  
Date: `2026-02-10`  
Owner: `Security / Platform Ops`  
Status: `Mandatory enforcement`

## Purpose
Enforce LAN-only access to Ollama on `ai-llm01` with deterministic bind settings and strict UFW source allowlists.

## Prerequisites
- `82.30` hardening applied.
- `82.40` Ollama installed.
- Source IPs known for `AI-DATA01`, `AI-FRONTEND01` (optional), and admin workstations.

## Inputs (current rollout)
- `ai-llm01`: `10.10.5.177`
- `AI-DATA01`: `10.10.5.181`
- `AI-FRONTEND01` (optional): `10.10.5.180`
- Admin diagnostics range: `10.10.5.10-15`
- `OLLAMA_PORT`: `11434/tcp`
- `SSH_PORT`: `22/tcp`

## Trust Boundary
- Primary pattern: only `AI-DATA01` calls Ollama.
- Optional: `AI-FRONTEND01` direct call only when explicitly required.
- Admin HTTP access to 11434 is diagnostic-only and should be temporary whenever possible.

## Bind Policy
- Option A (recommended): `OLLAMA_HOST=0.0.0.0:11434` + strict UFW allowlist.
- Option B: bind to LAN IP only (`10.10.5.177:11434`) + strict UFW.
- Option C (strictest): localhost + TLS proxy (handled separately).

Current client selection:
- Bind policy: `A`
- Caller allowlist: `10.10.5.180 + 10.10.5.181`
- Admin diagnostic access to 11434: `yes`

## Repo Artifacts
- Inputs: `infrastructure/ollama-gpu/82.60-lan-allowlist-inputs.env.example`
- Apply: `infrastructure/ollama-gpu/82.60-lan-allowlist-apply.sh`
- Verify: `infrastructure/ollama-gpu/82.60-lan-allowlist-verify.sh`
- Evidence: `infrastructure/ollama-gpu/82.60-evidence-checklist.md`

## Execution
1. Copy and fill env file.
2. Apply enforcement:
   - `sudo bash infrastructure/ollama-gpu/82.60-lan-allowlist-apply.sh --env-file infrastructure/ollama-gpu/82.60-lan-allowlist-inputs.env`
3. Verify controls:
   - `bash infrastructure/ollama-gpu/82.60-lan-allowlist-verify.sh --env-file infrastructure/ollama-gpu/82.60-lan-allowlist-inputs.env`

## Mandatory Verification
- `systemctl status ollama` is active.
- `ss -tulpen` shows expected 11434 listener.
- UFW default deny incoming is active.
- UFW rules allow only configured callers to `11434/tcp`.
- `AI-DATA01` remote test passes.
- Non-allowlisted host test fails.

## Troubleshooting
- No AI-DATA01 connectivity: validate UFW caller rule + bind target + routing.
- Unexpected host can connect: remove broad rules and re-apply 82.60 script.
- Listener mismatch: fix override and restart `ollama`.
