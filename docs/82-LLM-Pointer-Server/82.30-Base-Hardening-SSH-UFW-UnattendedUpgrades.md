# 82.30 LLM Pointer Server Base Hardening (SSH, UFW, Logging, Unattended Upgrades)

Document ID: `docs/82-LLM-Pointer-Server/82.30-Base-Hardening-SSH-UFW-UnattendedUpgrades`  
Version: `v1.0`  
Date: `2026-02-10`  
Owner: `Security / Platform Ops`

## Purpose
Apply mandatory baseline hardening to `ai-llm01`: LAN-only firewall model, SSH hardening, bounded logging, and unattended security patching.

## Scope
Base hardening only. Ollama runtime/service configuration is handled in follow-on runbooks.

## Prerequisites
- `82.20` Ubuntu install complete.
- Static IP configured and SSH reachable.
- Admin workstation allowlist IPs known.

## Target Posture
- SSH key-only auth, root SSH disabled.
- UFW default deny incoming, explicit allowlist only:
- admin SSH sources
- `hai-backend01` to `11434/tcp`
- fail2ban SSH jail enabled.
- journald/logrotate/rsyslog active with bounded retention.
- unattended security updates enabled.

## Repo Implementation
- Inputs: `infrastructure/ollama-gpu/82.30-hardening-inputs.env.example`
- Apply script: `infrastructure/ollama-gpu/82.30-hardening-apply.sh`
- Verify script: `infrastructure/ollama-gpu/82.30-hardening-verify.sh`
- Evidence checklist: `infrastructure/ollama-gpu/82.30-evidence-checklist.md`
- Templates:
- `infrastructure/ollama-gpu/82.30-sshd_config.baseline`
- `infrastructure/ollama-gpu/82.30-jail.local.baseline`
- `infrastructure/ollama-gpu/82.30-journald-override.conf`
- `infrastructure/ollama-gpu/82.30-50unattended-upgrades.baseline`
- `infrastructure/ollama-gpu/82.30-20auto-upgrades.baseline`

## Execution (On ai-llm01)
1. Copy env file and set real values.
2. Apply hardening:
   - `sudo bash infrastructure/ollama-gpu/82.30-hardening-apply.sh --env-file infrastructure/ollama-gpu/82.30-hardening-inputs.env`
3. Keep current SSH session open; test key login in second session.
4. Verify:
   - `bash infrastructure/ollama-gpu/82.30-hardening-verify.sh --env-file infrastructure/ollama-gpu/82.30-hardening-inputs.env`

## Mandatory Verification
- key auth works from allowlisted admin source.
- password SSH disabled (unless documented exception).
- root SSH disabled.
- UFW active and only intended allow rules present.
- fail2ban `sshd` jail enabled.
- unattended upgrades enabled and dry-run works.
- logging bounded and sane.

## Evidence
- `sshd -T | egrep 'permitrootlogin|passwordauthentication|port'`
- `ufw status verbose` and `ufw status numbered`
- `fail2ban-client status sshd`
- `unattended-upgrade --dry-run --debug` (first lines)
- `journalctl --disk-usage`
- `ss -tulpen`
