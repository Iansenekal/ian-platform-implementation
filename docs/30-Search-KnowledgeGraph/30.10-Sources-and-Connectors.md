# AI Platform Deployment Documentation
## 30.10 Search + Knowledge Graph - Sources and Connectors

LAN-only runtime - POPIA-friendly - Two-VM on Proxmox - Ubuntu 24.04

Document Control
- Document ID: `docs/30-Search-KnowledgeGraph/30.10-Sources-and-Connectors`
- Filename: `docs/30-Search-KnowledgeGraph/30.10-Sources-and-Connectors.md`
- Version: `v1.0`
- Date: `2026-02-09`
- Owner: Choice IT / Search Engineering + Security Architecture
- Status: Design baseline
- Scope: supported sources, connector principles, ACL capture, onboarding workflow
- Hard requirements: least privilege; ACL fidelity; minimization; auditability; secrets safety
- Related docs: `30.00`, `30.15`, `21.*`, `03.*`, `50.*`, `06.*`
- Default stance: index Nextcloud first; add others by explicit enablement
- Cloud note: M365 requires controlled outbound connector access; runtime remains on-prem

## 1. Supported Sources (Tiered)
Tier 1 (default):
- Nextcloud (primary source-of-truth for projects)
- approved local ingest folders (staging only)

Tier 2 (optional on-prem):
- SMB/Windows shares (read-only connector)
- local-device managed ingestion (prefer mediation via Nextcloud)

Tier 3 (optional cloud connectors):
- SharePoint Online
- OneDrive for Business
- Teams files (typically SharePoint-backed)

## 2. Connector Design Principles
- dedicated non-human service identities
- ACL fidelity required per item
- no ACL resolution means no indexing
- metadata-first minimization default
- strict secret handling under `/opt/<stack>/secrets`
- auditable connector runs and scope reporting
- idempotent behavior with safe reruns
- throttling/backpressure protection

## 3. Source Inventory Matrix
Each connector profile should define:
- stable ID strategy
- metadata fields
- ACL capture strategy
- extraction mode
- delta-sync behavior
- known source-specific caveats

## 4. Nextcloud Connector (Primary)
- indexes `/Projects/<PROJECTCODE>/...` metadata and permission state
- uses canonical group naming from `21.36` and ACL model from `21.37`
- stores index-time ACL tags and enforces query-time filters
- defaults to metadata indexing; sensitive-folder extraction disabled unless approved

## 5. SMB Connector (Optional)
- for legacy repositories not yet migrated
- read-only connector policy
- ACL capture from share + NTFS controls
- unresolved ACL ambiguity results in exclusion

## 6. Local Device Ingestion (Optional)
Preferred:
- ingest into Nextcloud; index Nextcloud only

Alternative:
- managed endpoint agent with strict allow/deny scope and governance
- higher complexity and privacy risk

## 7. Microsoft 365 Connectors (Optional)
- explicit client enablement required
- site/library scope restrictions mandatory
- least-privilege Graph scopes only
- OneDrive default is excluded unless approved
- metadata-first indexing recommended
- unresolved permission resolution means no indexing

## 8. Other Future Sources
- email/ticketing/wiki systems by explicit governance
- metadata-first onboarding for high-risk sources

## 9. Connector Onboarding Workflow
1. define source and business justification
2. define include/exclude scope
3. define minimization and extraction guardrails
4. define ACL proof and sampling plan
5. create scoped service identity
6. store connector secrets securely
7. enable in LAB with conservative concurrency
8. validate ACL deny tests and minimization behavior
9. validate performance and tuning
10. enable incremental schedule and retry policy
11. produce evidence bundle
12. promote via change control

## 10. Health, Throttling, and Failure Handling
- source-specific throttling policies
- exponential backoff for transient failure
- stop/escalate repeated auth failures
- dead-letter tracking for reprocessing
- run summaries with scanned/indexed/skipped/failed counts
- circuit-breaker pause when OpenSearch is unhealthy

## 11. Verification Checklist
- scope overreach tests pass
- ACL sample mapping matches source permissions
- deny tests show zero unauthorized leakage
- minimization rules exclude configured paths/types
- run summaries and failure logs are produced
- secrets not leaked in config/logs
- rate-limit and retry behavior verified

## 12. Client Rollout Variables
- enabled connector set
- per-source scope
- metadata/content mode and extraction allowlist
- sensitive exclusions and size limits
- identity naming and secret path
- schedule/concurrency/limit settings
- deletion propagation SLA
- evidence location and sign-off roles
