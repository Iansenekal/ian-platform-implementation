# AI Platform Deployment Documentation

## 11.50 Identity Provider - Local Users (No Directory)

LAN-only • POPIA-friendly • Two-VM on Proxmox • Ubuntu 24.04
Step-by-step local-user identity mode for sites without AD/LDAP, including account lifecycle controls, MFA requirements, monthly access review, and audit evidence.

## Document Control

| Field | Value |
|---|---|
| Document ID | `docs/11-Backend-Identity-Provider/11.50-Local-Users-No-Directory` |
| Filename | `docs/11-Backend-Identity-Provider/11.50-Local-Users-No-Directory.md` |
| Version | `v1.0` |
| Date | `2026-02-17` |
| Owner | Choice IT / Security Architecture + Identity Engineering |
| Status | Mandatory for local-user deployments |
| Runs on | AI-DATA01 (`10.10.5.187`) |
| Hard requirements | No directory dependency, MFA for admin/auditor, monthly access review |
| Security note | Store local-user bootstrap secrets in `/opt/idp/secrets`; never in docs |
| Evidence requirement | user lifecycle logs + MFA proof + access review sign-off |

## 1) Purpose and Outcomes

- Operate Keycloak without AD/LDAP directory dependency.
- Enforce controlled local-user lifecycle (create, modify, disable, delete).
- Enforce MFA for admin and auditor roles.
- Maintain monthly access review and audit evidence.

## 2) Threat Model Summary

- T1 Weak or shared local credentials -> strict password policy + unique named accounts.
- T2 Privilege creep -> role-bound groups + monthly review + disable stale users.
- T3 Orphaned accounts -> disable/delete workflow with evidence retention.
- T4 Admin account takeover -> MFA mandatory for admin/auditor users.
- T5 Missing accountability -> audit events for identity lifecycle actions.

## 3) Prerequisites

- Keycloak runtime available on AI-DATA01 (`10.10.5.187`).
- Frontend reverse proxy path remains the only LAN entrypoint (`443`).
- SMTP/notification channel configured for account lifecycle notifications (optional but recommended).
- Security owner and system owner assigned for monthly access review sign-off.

## 4) Local User Baseline

- Local users are permitted only when no directory services are available.
- Use stable platform groups (`AI-PLATFORM-ADMINS`, `AI-SECURITY-AUDITORS`, `AI-USERS-*`).
- No shared admin accounts.
- Break-glass account is controlled, rotated, and audited.

## 5) Configuration Standard

Use template artifact:
`infrastructure/keycloak/11.50-local-users.yaml.example`

Required baseline:
- Password minimum length `14`.
- Password complexity enabled.
- Lockout policy enabled.
- Required action for OTP setup.
- MFA required for admin/auditor users.

## 6) Local User Lifecycle Procedure

### 6.1 Provision

- Validate approved access request.
- Create named user with temporary password.
- Require password reset and OTP enrollment at first login.
- Assign only minimum role/group required.

### 6.2 Modify

- Apply role/group changes only through approved ticket.
- Record rationale and reviewer in evidence trail.

### 6.3 Disable/Delete

- Disable user immediately when employment/project access ends.
- Delete only after retention window and case confirmation.
- Preserve audit trail for compliance retention requirements.

## 7) Access Review and Evidence

Use templates:
- `infrastructure/keycloak/11.50-local-users-access-review.template.md`
- `infrastructure/keycloak/11.50-evidence-checklist.md`

Review cadence:
- Monthly review by security owner + system owner.
- Verify active users, role assignments, dormant users, and break-glass controls.

## 8) Verification Checklist

- V1: Local-user config file includes password, lockout, and MFA policy tokens.
- V2: Admin/auditor test users require OTP on login.
- V3: Dormant account disable flow is executable and logged.
- V4: Monthly access review template completed and signed.
- V5: Audit logs include create/disable/role-change events.

## 9) Client Rollout Variables

| Variable | Value |
|---|---|
| Backend IdP host | `10.10.5.187` |
| Frontend host | `10.10.5.179` |
| Realm | `platform` |
| Password minimum length | `14` |
| Lockout strategy | `temporary lock with retry threshold` |
| MFA required roles | `AI-PLATFORM-ADMINS`, `AI-SECURITY-AUDITORS` |
| Access review cadence | `monthly` |
| Evidence repository | `<secure path>` |
