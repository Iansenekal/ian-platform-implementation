# AI Platform Deployment Documentation
## 40.10 Automation - n8n (Optional) Ports and Trust Boundaries

LAN-only runtime - POPIA-friendly - Two-VM on Proxmox - Ubuntu 24.04

Document Control
- Document ID: `docs/40-Automation-n8n/40.10-Ports-Boundaries`
- Filename: `docs/40-Automation-n8n/40.10-Ports-Boundaries.md`
- Version: `v1.0`
- Date: `2026-02-09`
- Owner: Choice IT / Network + Security
- Status: Design baseline
- Scope: ports, trust boundaries, inbound/outbound rules, and UFW intent for n8n
- Hard requirements: LAN-only, strict allowlist, internal TLS, no public exposure
- Related docs: `02.00`, `02.10`, `02.20`, `40.00`
- Default placement: `AI-DATA01 (10.10.5.178)`
- Default access: Admin/Operators only, SSO + MFA
- Time zone: `Africa/Johannesburg`
- Lab CIDR: `10.10.5.0/24`
- Evidence requirement: UFW status outputs and deny tests from unauthorized hosts

## 1. Placement and Trust Zone Assumptions
- n8n is deployed on `AI-DATA01` by default in the backend/data zone.
- n8n is treated as privileged because it can move data across systems.
- inbound access is restricted to explicit admin/operator sources and optional frontend paths.
- outbound traffic is deny-by-default and allowlist-driven.

## 2. Inbound Ports (n8n UI/API)
- n8n UI/API is exposed through internal TLS reverse proxy only.
- direct container exposure on `5678` must remain localhost-only.

| Service | Port | Bind Scope | Allowed Inbound Sources | Notes |
|---|---|---|---|---|
| n8n UI/API via reverse proxy | 443 | LAN interface only | admin/operator allowlist; optional AI-FRONTEND01 | internal DNS + internal TLS |
| n8n container direct endpoint | 5678 | localhost only | reverse proxy process only | never expose directly to LAN |

## 3. Outbound Communications
- outbound defaults to deny; internal destinations are explicitly allowlisted.
- external destinations require explicit governance approval.

| Destination | Port(s) | Purpose | Restrictions |
|---|---|---|---|
| Backend Gateway | 443 | workflow orchestration APIs | internal TLS + allowlist |
| Nextcloud | 443 | file move/tag/route | scoped service account |
| Postgres | 5432 | workflow state | localhost preferred |
| OpenSearch | 9200 | reporting/alerts | read-only default |
| Identity Provider | 443 | SSO/token validation | LAN only |
| Email relay | 25/587 | internal notifications | LAN only |

## 4. UFW Allowlist Intent
- inbound `443` is restricted to named admin/operator source endpoints.
- allow `AI-FRONTEND01` inbound only when integration requires it.
- all other LAN hosts are denied by default.

## 5. Trust Boundary Rules
- no Docker socket or host-privileged API access from n8n.
- service credentials are scoped per integration and environment.
- sensitive actions should route via Backend Gateway policy enforcement.
- DB writes are limited to workflow-state schema; no identity-store writes.

## 6. Integration Boundaries
### 6.1 Nextcloud
- use dedicated service account(s) and scoped folder access.
- preserve ACL expectations during file operations.

### 6.2 Backend Gateway
- preferred policy enforcement point for business decisions and auditing.

### 6.3 Postgres
- localhost preferred; least-privilege DB role on workflow schema only.

### 6.4 OpenSearch
- read-only default; write/index mutations require explicit approval.

## 7. Risk Notes and Mitigations
- credential sprawl: secrets standard, rotation, and periodic access reviews
- overbroad automation: change control and scoped service identities
- lateral movement via UI: strict allowlists, SSO+MFA, role separation
- data exfiltration: outbound deny-by-default, no unrestricted internet egress

## 8. Verification Checklist
- n8n reachable only from allowlisted sources
- port `5678` not exposed to LAN
- reverse proxy enforces internal TLS and host validation
- outbound rules enforce approved internal destinations only
- integration credentials are scoped and secrets-managed

## 9. Client Rollout Variables
- n8n enabled
- deployment VM
- n8n internal DNS name
- reverse proxy choice
- inbound allowlist IPs
- allow frontend inbound
- outbound allowed destinations
- external outbound exception list
- Nextcloud service account scope
- DB usage mode
- OpenSearch access mode
- admin RBAC roles
