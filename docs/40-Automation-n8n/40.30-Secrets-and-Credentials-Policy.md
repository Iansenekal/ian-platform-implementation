# AI Platform Deployment Documentation
## 40.30 Automation - n8n (Optional) Secrets and Credentials Policy

LAN-only runtime - POPIA-friendly - Two-VM on Proxmox - Ubuntu 24.04

Document Control
- Document ID: `docs/40-Automation-n8n/40.30-Secrets-and-Credentials-Policy`
- Filename: `docs/40-Automation-n8n/40.30-Secrets-and-Credentials-Policy.md`
- Version: `v1.0`
- Date: `2026-02-09`
- Owner: Choice IT / Security + Platform Ops
- Status: Mandatory if n8n is enabled
- Scope: secret handling, connector credentials, storage rules, rotation, and incident response
- Hard requirements: no hardcoded secrets, least privilege, auditability, offline recovery, POPIA minimization
- Related docs: `03.20`, `03.30`, `04.40`, `40.20`
- Default stance: one service account per integration with scoped credentials and regular rotation
- Primary risk: n8n credential sprawl and leakage
- Time zone: `Africa/Johannesburg`
- Evidence requirement: credential inventory, rotation records, and secret scans

## 1. Policy Goals and Principles
- prevent secret leakage into git, docs, logs, screenshots, tickets, or chat
- bind each credential to explicit owner, purpose, scope, and lifecycle metadata
- enforce least privilege and environment separation
- enable auditable rotation and recovery

## 2. Secret Types and Storage
### 2.1 Host-level secrets (mandatory)
- store deployment secrets under `/opt/n8n/secrets` with strict file permissions
- `.env` references file paths, not inline secret values
- includes encryption keys, DB secrets, webhook signing keys, and related material

### 2.2 Application credentials (governed)
- n8n credentials are encrypted at rest using n8n encryption key controls
- only admins/credentials custodians can create or rotate credentials
- builders reference approved credentials without viewing secret material where supported

### 2.3 Prohibited practices
- no secrets in workflow JSON nodes/fields/query params
- no token sharing in docs, tickets, email, or chat
- no shared credentials across unrelated scopes without explicit exception

## 3. Service Accounts by Integration
- Nextcloud: dedicated automation accounts scoped to required folders/projects
- Backend Gateway: prefer short-lived credentials; scope API keys to required endpoints
- Postgres: dedicated least-privilege role on workflow schema only
- OpenSearch: read-only default, write only by approved exception

## 4. Naming and Ownership
- naming format: `N8N::<INTEGRATION>::<SCOPE>::<ENV>`
- each credential requires owner, purpose, scope, create date, rotate date, and expiry/review date
- maintain inventory in controlled governance storage

## 5. Credential Creation Procedure
1. owner requests credential with scope and data classification
2. security approves least-privilege scope
3. custodian creates account/secret and stores host-level files securely
4. n8n credential entry is registered with encrypted storage
5. least-privilege negative tests confirm blocked operations
6. credential inventory is updated with lifecycle metadata

## 6. Rotation Policy
- encryption key: annual or policy-driven, with re-encryption planning
- Nextcloud and API tokens: 90 days default
- DB passwords and webhook keys: 180 days default
- immediate rotation on compromise, role changes, or scope changes

## 7. Export/Import Hygiene
- workflow exports are sanitized and secret-free
- placeholders used for endpoints/IDs; runtime credentials injected securely
- DEV/LAB and PROD credential sets remain strictly separated

## 8. Secret Exposure Incident Response
1. contain by disabling exposed credentials
2. assess exposure locations and blast radius
3. rotate and rebind credentials
4. purge leaked material from stores/history
5. review execution activity during exposure window
6. improve controls and scanning/prevention

## 9. Audit Requirements
- log credential create/update/rotate/delete with actor and timestamp
- record approvals and scoped purpose in inventory
- capture admin access to credential management controls where possible
- retain before/after rotation evidence in audit pack

## 10. Verification Checklist
- no secrets in compose/git/docs; file-based secrets follow required permissions
- n8n encryption key exists and credentials are encrypted at rest
- inventory matches active credentials
- least-privilege deny tests pass
- rotation schedule and reminders are defined and operational
- incident-response tabletop for secret exposure is completed

## 11. Client Rollout Variables
- n8n enabled
- credentials custodian role
- credential naming standard
- Nextcloud service accounts and scopes
- gateway credential mode
- DB usage and scope
- OpenSearch access mode
- rotation intervals by credential type
- inventory storage location
- secret exposure response owner
- secret scanning tooling/process
