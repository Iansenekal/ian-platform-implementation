# AI Platform Deployment Documentation
## 40.50 Automation - n8n (Optional) Backup and Restore

LAN-only runtime - POPIA-friendly - Two-VM on Proxmox - Ubuntu 24.04

Document Control
- Document ID: `docs/40-Automation-n8n/40.50-Backup-Restore`
- Filename: `docs/40-Automation-n8n/40.50-Backup-Restore.md`
- Version: `v1.0`
- Date: `2026-02-09`
- Owner: Choice IT / Platform Ops
- Status: Mandatory if n8n is enabled
- Scope: backup scope, schedules, restore process, and post-restore validation
- Hard requirements: no unencrypted secrets in backups; restore test required; evidence retained
- Related docs: `06.*`, `03.20`, `40.30`, `50.*`
- Placement assumption: `AI-DATA01`
- Time zone: `Africa/Johannesburg`
- Evidence requirement: backup logs, restore test report, deny tests
- RPO/RTO alignment: client-specific in `06.*`

## 1. Required Backup Scope
- n8n database and execution state metadata
- sanitized workflow exports with version history
- n8n configuration templates and runtime config (non-secret)
- reverse proxy configuration where n8n ingress is dedicated
- operational governance artifacts (workflow catalog, credential inventory metadata, approvals)
- encryption-key recovery path required so restored credentials can decrypt

## 2. Disallowed Backup Content (unless encrypted)
- plaintext secrets in notes/docs/tickets
- unencrypted secret files
- screenshots or dumps containing credentials/tokens
- raw debug payloads containing sensitive data without approval/redaction

## 3. Recommended Backup Frequency and Retention
- n8n database: daily (or higher for high-volume), retention 30-90 days
- workflow exports: on every change plus daily snapshot, retention 180-365 days
- configuration templates/proxy config: on change plus weekly snapshot, retention 180 days
- audit evidence pack: weekly, retention 180-365 days

## 4. Restore Procedure
1. confirm incident scope and restoration target
2. validate availability of correct n8n encryption key material
3. restore n8n database from known-good backup
4. restore configuration and reverse proxy assets where needed
5. start services and confirm health + SSO availability
6. execute mandatory post-restore verification
7. capture evidence (time, backup set, validation outcomes)

## 5. Mandatory Post-Restore Verification
- n8n starts cleanly and remains healthy
- SSO login and admin MFA enforcement function correctly
- expected workflows are present
- credentials decrypt successfully (no key mismatch)
- sample workflow execution succeeds with least-privilege credentials
- RBAC deny test confirms standard users cannot access admin controls
- logs/audit remain active without secret leakage
- scheduled backups resume after recovery

## 6. Restore Test Schedule
- monthly: lightweight lab restore (DB restore + startup validation)
- quarterly: full restore including representative workflow execution + RBAC/MFA checks
- post-upgrade: restore validation from fresh backup set

## 7. Client Rollout Variables
- n8n enabled
- backup tooling standard
- backup destination path
- DB backup frequency
- retention days
- encryption key storage method
- workflow export repository location
- restore test cadence
- RPO/RTO targets
- evidence repository path
- restore approval roles
