# AI Platform Deployment Documentation
## 40.00 Automation - n8n (Optional) Overview

LAN-only runtime - POPIA-friendly - Two-VM on Proxmox - Ubuntu 24.04

Document Control
- Document ID: `docs/40-Automation-n8n/40.00-Overview`
- Filename: `docs/40-Automation-n8n/40.00-Overview.md`
- Version: `v1.0`
- Date: `2026-02-09`
- Owner: Choice IT / Platform Engineering + Security
- Status: Design baseline
- Scope: n8n role, trust boundaries, governance, and rollout approach
- Hard requirements: LAN-only, least privilege, secrets hygiene, auditable workflows, no cloud runtime dependency
- Related docs: `02.*`, `03.*`, `04.*`, `06.*`, `50.*`
- Placement: Optional module, recommended on `AI-DATA01`
- Primary integrations: Gateway APIs, Nextcloud, Postgres, OpenSearch (read-only default), Windmill (optional)
- Time zone: `Africa/Johannesburg`
- Lab defaults: `AI-DATA01 10.10.5.178`, `AI-FRONTEND01 10.10.5.179`, `LAN 10.10.5.0/24`
- Evidence requirement: workflow catalog, access reviews, deny tests, backup/restore test

## 1. Role of n8n in the Platform
- n8n is the orchestration layer for trigger -> decision -> action workflows.
- It supports scheduled jobs, event-driven automations, and human-in-the-loop processes.
- Runtime is LAN-only by default; external connectors require explicit governance approval.

## 2. Allowed and Disallowed Patterns
### 2.1 Allowed
- call internal Gateway APIs for approved workflow actions
- write to scoped Nextcloud folders using dedicated service accounts
- read OpenSearch for internal alerting/reporting (read-only by default)
- write only to dedicated workflow-state Postgres schemas
- send internal notifications through approved LAN mail relay patterns

### 2.2 Not Allowed by Default
- direct infrastructure admin operations (Docker socket, SSH, firewall changes)
- unscoped repository/project access
- long-lived secrets embedded in workflow JSON/exports
- outbound internet calls unless explicitly approved and allowlisted

## 3. Deployment Placement
- default deployment on `AI-DATA01` for data-tier locality and tighter controls
- optional `AI-FRONTEND01` placement only when client policy requires
- public internet exposure is prohibited; LAN-only access with allowlists and SSO

## 4. Trust Boundaries and Data Flow
- n8n is treated as a privileged internal application.
- business decisions route through Gateway APIs where possible.
- each connector uses narrowly scoped service identities.

| Component | Can Talk To | Purpose | Restrictions |
|---|---|---|---|
| n8n (AI-DATA01) | Backend Gateway | orchestrate approved APIs | internal TLS and allowlists |
| n8n (AI-DATA01) | Nextcloud | route/label documents | scoped folders only |
| n8n (AI-DATA01) | Postgres | workflow state | dedicated schema, least privilege |
| n8n (AI-DATA01) | OpenSearch | reporting/alerts | read-only default |
| n8n (optional) | Windmill | trigger jobs | RBAC-gated and audited |

## 5. Identity, SSO, and MFA Posture
- integrate n8n with platform IdP SSO where possible
- admin access requires MFA and least-privilege role assignment
- non-admin users should only see owned/operated workflows
- break-glass controls align to `04.70`

## 6. Secrets and Credentials Governance
- no secrets in docs, git, or compose files
- secrets stored under `/opt/<stack>/secrets` with strict permissions
- connector credentials are per integration and per environment
- sanitize workflow exports before sharing

## 7. Workflow Lifecycle and Change Control
1. request submitted with purpose and data classification
2. design defines inputs, outputs, minimization, and permissions
3. security approval validates scope and retention impact
4. build in LAB using test data
5. functional + deny + performance tests
6. promotion with versioned export/import and change ticket
7. operations monitoring and periodic re-approval on scope changes

## 8. POPIA Controls
- pass references/IDs instead of full content where possible
- define retention for execution logs; disable sensitive payload logging by default
- audit all workflow changes (who, when, what)

## 9. Observability and Operations
- expose health endpoints for internal monitoring
- route workflow failure alerts to operations
- use retries/backoff and concurrency caps to protect dependencies

## 10. Backup and DR Posture
- backup includes n8n DB/state, workflow exports, and config references
- restore verification includes SSO, workflow execution, and credential validity checks
- quarterly restore test for representative workflow sets

## 11. Verification Checklist
- LAN-only access and UFW allowlists enforced
- SSO + MFA works for admin roles
- no secrets in logs or exports
- workflow catalog has owners and classifications
- backup/restore evidence exists and alerts are operational

## 12. Client Rollout Variables
- n8n enabled
- deployment VM
- internal n8n URL
- SSO enabled
- admin MFA required
- allowed integrations list
- service-account naming pattern
- workflow log retention days
- sensitive payload logging mode
- backup schedule/storage
- alert recipients/escalation path
- change approval roles
