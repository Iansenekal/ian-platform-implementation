# AI Platform Deployment Documentation

## 06.00 Backup + DR - Backup Scope (What is Protected)

LAN-only runtime • POPIA-friendly • Two-VM on Proxmox • Ubuntu 24.04  
Defines exactly what must be backed up, what must never be backed up unencrypted, and how backup scope maps to RPO/RTO (no code).

## Document Control

| Field | Value |
|---|---|
| Document ID | `docs/06-Backup-DR/06.00-Backup-Scope` |
| Filename (target) | `docs/06-Backup-DR/06.00-Backup-Scope.md` |
| Version | `v1.0` |
| Date | `2026-02-09` |
| Owner | Choice IT / Platform Ops |
| Status | Baseline (mandatory) |
| Scope | Backup scope for AI-DATA01 and AI-FRONTEND01, including data, configs, secrets, and evidence packs |
| Hard requirements | LAN-only; encryption at rest; least privilege; POPIA minimization; restore testing required |
| Related docs | 06.10 Schedules; 06.20 Restore; 06.30 DR Runbook; 03.20 Secrets; 03.40 Retention; 50.* Monitoring |
| Lab defaults | AI-DATA01 `10.10.5.178`; AI-FRONTEND01 `10.10.5.179`; LAN `10.10.5.0/24` |
| Assumed runtime | Docker Compose + systemd; UFW allowlists; internal TLS |
| Backup destinations | LAN-only storage (NAS/backup server) with access controls |
| Evidence requirement | Backup logs + restore test reports + scope inventory |
| POPIA note | Backups contain personal information; apply minimization, retention, and access controls |
| RPO/RTO source | Client-specific; documented in 06.10 + client variables |
| Approver | Platform Owner + Security |
| Note | If a component is enabled, it must be included in scope unless explicitly excluded with risk acceptance |

## Contents

- 1. Backup scope principles
- 2. Platform backup scope overview (by VM)
- 3. Application data scope (per module)
- 4. Configuration scope (compose/config/systemd/UFW)
- 5. Secrets scope (what is backed up and how)
- 6. Evidence and audit scope
- 7. What is excluded (or conditional)
- 8. Scope-to-RPO/RTO mapping guidance
- 9. Verification checklist (scope correctness)
- 10. Client rollout variables (template)

## 1. Backup scope principles

- Back up what you cannot recreate quickly and safely (data, configs, keys, evidence).
- Assume hostile recovery: backups must be encrypted and access-controlled.
- Separate "data" from "code": code can be re-deployed; data and state cannot.
- Prefer app-consistent backups for databases (logical dumps or supported snapshots).
- Retention and purge must be enforced to remain POPIA-friendly.

## 2. Platform backup scope overview (by VM)

### 2.1 AI-DATA01 - must include

- Database state for platform services (Postgres) - critical.
- OpenSearch data and index state - critical.
- Nextcloud data + database + config (if enabled) - critical.
- Gateway configuration and any persistent state - critical.
- Automation tool state (n8n and/or Windmill) if enabled - important/critical depending on usage.
- Configuration assets under `/opt/<stack>/` (compose, configs, systemd units, scripts).
- Secrets under `/opt/<stack>/secrets` (encrypted backup required).
- Audit log archives and evidence packs per retention policy.

### 2.2 AI-FRONTEND01 - must include

- Frontend deployment configuration (`/opt/<stack>/` compose/config/systemd) - important.
- Any persistent UI state/caches that are required (usually minimal).
- TLS internal certificates/keys if stored here (prefer centralized CA; still backup key material).
- Custom UI configuration, feature flags, and SSO client configs (non-secret templates).

## 3. Application data scope (per module)

| Module | What must be backed up | Where it lives (typical) | Sensitivity | Backup type preference | Notes |
|---|---|---|---|---|---|
| Postgres (platform DB) | All databases + roles/permissions | AI-DATA01 local volume | High | App-consistent (logical) + snapshots | Keep restore drills |
| OpenSearch | Indices + cluster settings/templates | AI-DATA01 local volume | Medium/High | Snapshots + index exports | Retention controls apply |
| Nextcloud (if enabled) | Data directory + DB + config/apps | AI-DATA01 volumes | High | App-consistent + file backups | File shares may contain PII |
| Backend Gateway | Config + policy + logs (per retention) | `/opt/gateway` + logs | Medium | Config backup + redeployable code | Keep config and policy |
| Search/Knowledge Graph | Graph store + connector state | AI-DATA01 volumes | High | App-consistent | Must preserve ACL mapping state |
| n8n (optional) | Workflow DB + credentials refs + workflow exports | AI-DATA01 volumes | High | DB backup + exports | No secrets in exports |
| Windmill (optional) | DB + scripts/flows exports + settings | AI-DATA01 volumes | High | DB backup + exports | No secrets in exports |
| Monitoring (Prometheus/Grafana) | Dashboards, alert rules, config | AI-DATA01 or MONITOR01 | Medium | Config backup | Metrics history optional |
| Audit store (if OpenSearch) | Audit indices/archives | AI-DATA01 | High | Snapshots + archives | Treat as evidence |

## 4. Configuration scope (compose/config/systemd/UFW)

- All `/opt/<stack>/` directories for enabled stacks (compose files, configs, scripts, healthchecks).
- `systemd` unit files that control auto-start and watchdog behavior (if used).
- UFW rule definitions or scripts (policy as code) used to enforce allowlists.
- Reverse proxy configuration (Caddy/NGINX internal TLS) and internal CA materials.
- Host-level config relevant to security posture (SSH hardening, fail2ban configs, unattended upgrades configs).

## 5. Secrets scope (what is backed up and how)

### 5.1 What secrets are in scope

- Database passwords and service credentials stored under `/opt/<stack>/secrets/`
- TLS private keys and internal CA private key (if applicable)
- SSO client secrets (IdP clients), API keys, webhook signing keys (if used)
- Encryption keys used by applications (e.g., Nextcloud config secrets, automation tool encryption keys)

### 5.2 Rules for backing up secrets

- Secrets must be encrypted at rest in the backup system.
- Access to secret backups is dual-control where possible (two-person approval).
- Do not store secrets in documentation, tickets, or plaintext exports.
- Validate secret recovery as part of quarterly restore tests.

## 6. Evidence and audit scope

- Backup job logs (success/failure) retained per retention policy.
- Restore test reports (date, scope, outcome, evidence).
- Audit log archives (if required by policy) - protected and read-only for auditors.
- Security baselines and change approvals (RBAC changes, firewall changes, secret rotations).

## 7. What is excluded (or conditional)

- OS-level caches and temporary directories (rebuildable).
- Container images (re-pullable) unless the site is fully air-gapped (then include offline image registry strategy).
- Metrics history (optional): if storage is constrained, keep only configs and short history.
- User endpoints/devices: not in scope unless explicitly included (workstations, laptops).

Any exclusion must be documented with rationale and formal risk acceptance.

## 8. Scope-to-RPO/RTO mapping guidance

- RPO (data loss tolerance) drives how often you back up each stateful component (DB, OpenSearch, Nextcloud).
- RTO (time to restore) drives whether you use snapshots, replicas, or just logical backups.
- Classify each module: Critical (affects all users), Important (affects some workflows), Optional (nice-to-have).
- For POPIA: define retention windows and ensure backups do not become "forever storage".

## 9. Verification checklist (scope correctness)

- PASS: Every enabled module has a documented backup item in the scope table.
- PASS: All `/opt/<stack>/` config directories are included.
- PASS: Secrets are included only in encrypted form with restricted access.
- PASS: Audit/evidence artifacts are included and protected.
- PASS: Exclusions are documented and approved.
- PASS: Scope aligns to RPO/RTO targets in 06.10 schedules.

## 10. Client rollout variables (template)

| Variable | Value |
|---|---|
| Backup destination (LAN path / NAS) | `<fill>` |
| Backup tool (client standard) | `<fill>` |
| Encryption method (at rest) | `<fill>` |
| RPO target for Postgres | `<fill>` |
| RPO target for OpenSearch | `<fill>` |
| RPO target for Nextcloud | `<fill>` |
| Retention (days) per data class | `<fill>` |
| Air-gapped site? (Yes/No) | `<fill>` |
| Include metrics history? (Yes/No) | `<fill>` |
| Include audit archives? (Yes/No) | `<fill>` |
| Dual-control for secret backups? (Yes/No) | `<fill>` |
| Restore test frequency | `<fill>` |
