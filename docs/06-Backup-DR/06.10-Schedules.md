# AI Platform Deployment Documentation

## 06.10 Backup + DR - Backup Schedules (RPO/RTO-Aligned)

LAN-only runtime • POPIA-friendly • Two-VM on Proxmox • Ubuntu 24.04  
Defines recommended backup frequencies, retention windows, and testing cadence aligned to RPO/RTO (no code).

## Document Control

| Field | Value |
|---|---|
| Document ID | `docs/06-Backup-DR/06.10-Schedules` |
| Filename (target) | `docs/06-Backup-DR/06.10-Schedules.md` |
| Version | `v1.0` |
| Date | `2026-02-09` |
| Owner | Choice IT / Platform Ops |
| Status | Baseline (mandatory) |
| Scope | Backup frequencies, retention, and restore testing cadence for all in-scope modules |
| Hard requirements | LAN-only backup destinations; encrypted at rest; retention enforced; evidence retained |
| Related docs | 06.00 Scope; 06.20 Restore; 06.30 DR Runbook; 03.40 Retention; 50.* Monitoring |
| Time zone | Africa/Johannesburg |
| Lab defaults | AI-DATA01 `10.10.5.178`; AI-FRONTEND01 `10.10.5.179` |
| RPO/RTO approach | Set per module (Critical/Important/Optional) and per client |
| Approver | Platform Owner + Security |
| Note | Schedules are recommendations; client-specific values must be captured in variables table |
| Evidence requirement | Backup run logs + restore test reports + retention purge evidence |
| Change control | Any schedule change requires approval and must be recorded |
| Air-gapped sites | Adjust schedules and include offline transport procedures if needed |
| POPIA note | Backups are regulated data; retention must not exceed policy |
| Dependencies | Time sync (NTP), sufficient storage capacity, and monitored backup jobs |
| Glossary | RPO=Recovery Point Objective; RTO=Recovery Time Objective |

## Contents

- 1. Scheduling principles
- 2. Default tier model (Critical / Important / Optional)
- 3. Recommended schedules by module
- 4. Retention windows (POPIA-aligned)
- 5. Restore testing cadence
- 6. Monitoring and alerting for backups
- 7. Capacity planning for backup storage
- 8. Client rollout variables (template)

## 1. Scheduling principles

- RPO drives how often backups run; RTO drives whether you add snapshots/replication.
- Use shorter retention for operational data; longer retention for audit evidence only when required.
- Never allow backups to become "forever storage". Enforce purge with evidence.
- Separate backup schedules for: stateful databases, file stores, configs, and audit archives.
- Backups must be monitored; missed backups must raise alerts (P1).

## 2. Default tier model (Critical / Important / Optional)

| Tier | Typical components | Default RPO guidance | Default RTO guidance |
|---|---|---|---|
| Critical | Postgres, OpenSearch, Nextcloud, IdP | <= 24h (or tighter if required) | Hours (same day) |
| Important | Gateway configs, automation state (if in use) | 24h-48h | Same/next day |
| Optional | Metrics history, non-critical caches | Weekly or none | Best-effort |

## 3. Recommended schedules by module

| Module | Tier | Backup type | Frequency | Run window | Retention | Owner | Notes |
|---|---|---|---|---|---|---|---|
| Postgres (platform DB) | Critical | App-consistent logical + snapshot | Daily (or 2x daily if required) | 02:00-04:00 | 30-90 days | Ops/DB | Keep weekly full + daily incremental if supported |
| OpenSearch indices | Critical | Snapshots + archive metadata | Daily | 02:00-04:00 | 30-90 days | Ops | Align with search retention and index rollover |
| Nextcloud data + DB (if enabled) | Critical | File backup + DB backup | Daily | 02:00-05:00 | 30-90 days | Ops | Large file stores may require longer window |
| IdP (if enabled) | Critical | DB/config backup | Daily | 02:00-03:00 | 90 days | Ops/Sec | Include realm/client configs and mappings |
| Gateway config/policy | Important | Config backup | On change + daily snapshot | Anytime | 180 days | Ops | Code is redeployable; configs are not |
| Search/Knowledge Graph store | Critical | DB/graph store backup | Daily | 02:00-04:00 | 30-90 days | Ops | Must preserve ACL mapping state |
| n8n (optional) | Important/Critical | DB backup + workflow exports | Daily (if used) | 02:00-03:30 | 30-90 days | Ops | Exports on every change; no secrets in exports |
| Windmill (optional) | Important/Critical | DB backup + script exports | Daily (if used) | 02:00-03:30 | 30-90 days | Ops | Exports on every change; no secrets in exports |
| Configs under `/opt/*` | Important | File backup | Daily | Anytime | 180 days | Ops | Includes compose/systemd/ufw scripts/templates |
| Audit archives (if required) | Important | Archive + immutable storage | Weekly | Weekend | 180-365 days | Security/Compliance | Evidence; restrict access; legal hold supported |
| Monitoring config (dashboards/rules) | Important | Config backup | Weekly + on change | Weekend | 180 days | Ops | Metrics history optional |

## 4. Retention windows (POPIA-aligned)

- Default retention must align to business needs and legal/compliance requirements.
- Operational data backups: 30-90 days recommended; adjust for storage and policy.
- Audit evidence: 180-365 days only if required; otherwise minimize.
- Legal hold extends retention by exception only, with approval and end date.

## 5. Restore testing cadence

- Monthly: sample restore for one critical component in a lab (rotate components monthly).
- Quarterly: full-stack restore test (data + configs + SSO/RBAC validation).
- After major upgrades: run a restore test from a fresh backup set before declaring go-live.
- Evidence: produce a restore test report with timestamps, backup set IDs, and validation results.

## 6. Monitoring and alerting for backups

- P1 alert on any failed backup run for critical/important components.
- P1 alert if a backup is missed (no successful run within expected frequency).
- P0 alert if backup destination is unavailable or storage is near full.
- Track backup duration trends to detect growth and window overruns.

## 7. Capacity planning for backup storage

- Estimate daily change rates for Postgres, OpenSearch, and file stores (Nextcloud).
- Plan storage for retention windows plus 20-30% headroom.
- Review monthly: growth trends, compression ratios, and retention effectiveness.
- If constrained, reduce retention rather than skipping backups; document and approve changes.

## 8. Client rollout variables (template)

| Variable | Value |
|---|---|
| Backup destination path (LAN-only) | `<fill>` |
| Backup window (start/end) | `<fill>` |
| Postgres backup frequency | `<fill>` |
| OpenSearch snapshot frequency | `<fill>` |
| Nextcloud backup frequency | `<fill>` |
| IdP backup frequency | `<fill>` |
| Automation backups enabled (n8n/Windmill) | `<fill>` |
| Retention for operational backups (days) | `<fill>` |
| Retention for audit archives (days) | `<fill>` |
| Monthly restore test owner | `<fill>` |
| Quarterly full restore test date | `<fill>` |
| Alert recipients (P0/P1) | `<fill>` |
| Storage headroom threshold (%) | `<fill>` |
