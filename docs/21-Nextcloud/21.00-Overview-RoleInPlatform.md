# AI Platform Deployment Documentation
## 21.00 Nextcloud - Overview and Role in the Platform

LAN-only - POPIA-friendly - Two-VM on Proxmox - Ubuntu 24.04

Document Control
- Document ID: `docs/21-Nextcloud/21.00-Overview-RoleInPlatform`
- Filename: `docs/21-Nextcloud/21.00-Overview-RoleInPlatform.md`
- Version: `v1.0`
- Date: `2026-02-09`
- Owner: Choice IT / Platform Engineering + Security Architecture
- Status: Mandatory - Nextcloud is the canonical content workspace for projects
- Runs on: AI-DATA01 (recommended) or dedicated storage VM (future)
- Primary purpose: Secure file collaboration + governed project folders + controlled sharing + audit events
- Hard requirements: LAN-only; internal TLS; RBAC; least privilege; audit logs; retention policy; backups and restore tests
- Related docs: `01.*`, `02.*`, `03.*`, `04.*`, `11.*`, `30.*`
- Install order position: After IdP + Gateway verified; before Search/KG indexing goes live
- Evidence requirement: access-control tests, audit evidence, backup restore test
- Time zone: `Africa/Johannesburg`
- Lab defaults: AI-DATA01 `10.10.5.178`; AI-FRONTEND01 `10.10.5.179`; DNS `10.10.5.160`; domain `lab.local`

## 1. Why Nextcloud Exists in This Platform
Nextcloud provides a governed, LAN-only collaboration workspace aligned to POPIA and security-first requirements. It is the structured source of truth for project folders and documents.

In this platform, Nextcloud enables:
- governed project folder standards and access control
- centralized ingestion source for Search + Knowledge Graph
- consistent permissions across projects and departments
- auditable collaboration and sharing controls

## 2. Where Nextcloud Fits (Two-VM Architecture)
- Recommended placement: AI-DATA01 hosts Nextcloud and storage.
- User access path: `https://nc.<domain>` via AI-FRONTEND01 ingress.
- Internal services (database/cache) remain non-public.
- Search/KG connectors pull from Nextcloud via scoped service accounts and ACL inheritance.

Nextcloud should not be hosted on AI-FRONTEND01 because content risk belongs in the protected data tier.

## 3. Primary Responsibilities
- Secure file collaboration and governed project storage
- Group-based granular authorization aligned with platform RBAC
- Controlled sharing defaults (external sharing off unless approved)
- Compliance evidence and audit event support
- Primary source system for Search/KG ingestion

## 4. Trust Boundaries and Access Paths
Inbound:
- LAN users use `nc.<domain>` over HTTPS through AI-FRONTEND01 only.
- Admin SSH to AI-DATA01 remains Zone E allowlist restricted.
- Internal service ports are never exposed to normal LAN users.

Outbound:
- Internal notifications/integration traffic only as required.
- No public cloud dependency is required for core runtime.

## 5. Identity and Authentication Options
- Preferred: SSO with platform IdP (OIDC/SAML) with MFA policy from `04.*` and `11.*`.
- Alternative: AD integration via LDAPS where SSO is not chosen.
- Fallback: Local users with strict lifecycle, lockout, and MFA controls.

Authorization remains consistent through canonical group taxonomy and project ACL blueprint.

## 6. Authorization Model Overview
Required role categories:
- Platform Admin (Tier 0)
- Security/Audit (Tier 1)
- Project Owner
- Project Editor
- Project Viewer (Read-only)
- Service accounts for connector/indexer scope

Granular goals:
- per-project isolation
- read-only as first-class role
- no broad "Everyone" project-root access
- external sharing disabled by default

## 7. Project Folder Blueprint Overview
- One governed project root per project code
- Standard subfolder structure for consistency
- ACL inheritance from project root unless explicitly governed otherwise
- Group taxonomy aligned to `AI-NC-PROJ-<CODE>-VIEW/EDIT/OWNER`

Detailed folder ACL model is handled in `21.35` to `21.37`.

## 8. Integrations That Matter
Search/KG:
- Nextcloud is a primary ingestion source.
- ACL inheritance is mandatory, including metadata and graph edge filtering.

End-user access:
- web UI (`nc.<domain>`)
- optional desktop sync on approved devices
- optional mobile access with policy controls

Document editing:
- local-edit/re-upload baseline
- optional LAN-only OnlyOffice/Collabora in later scope

## 9. POPIA, Data Minimization, and Retention
- Store only project-required data
- Align retention and purge to policy (`03.40`)
- Capture audit evidence for access and sharing
- Keep public/external sharing disabled unless approved and time-bound

## 10. Operational Model
- Logging: app/access/audit streams without secrets
- Monitoring: service health and host metrics
- Backups: datastore + database + config
- Restore tests: mandatory and periodic
- Upgrades: controlled maintenance windows with rollback path

## 11. Install Sequencing (Authoritative)
1. Complete IdP deployment and verification.
2. Complete frontend ingress baseline.
3. Deploy Nextcloud core on AI-DATA01 and route via AI-FRONTEND01.
4. Configure auth mode (SSO preferred; AD/Local fallback).
5. Apply group/role model and project ACL blueprint (`21.35` to `21.37`).
6. Enable audit/retention alignment.
7. Implement backups and execute restore test.
8. Enable Search/KG ingestion using least-privileged service accounts.

## 12. Client Rollout Variables
- Nextcloud hostname: `nc.<domain>`
- Runtime host: AI-DATA01 (recommended)
- Access path: HTTPS via AI-FRONTEND01 reverse proxy
- Auth mode: SSO preferred / AD LDAPS / Local users
- MFA policy: Tier 0/1 mandatory via IdP
- Project group pattern: `AI-NC-PROJ-<CODE>-VIEW/EDIT/OWNER`
- External sharing: disabled by default
- Backup + restore cadence: client policy (quarterly restore recommended)
- Connector service account scope: per-project least privilege
