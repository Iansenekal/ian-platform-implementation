# AI Platform Deployment Documentation
## 21.45 Nextcloud - Audit Logging Events (What to Log + Evidence Pack)

LAN-only - POPIA-friendly - Two-VM on Proxmox - Ubuntu 24.04

Document Control
- Document ID: `docs/21-Nextcloud/21.45-Audit-Logging-Events`
- Filename: `docs/21-Nextcloud/21.45-Audit-Logging-Events.md`
- Version: `v1.0`
- Date: `2026-02-09`
- Owner: Choice IT / Security Operations + Governance
- Status: Mandatory - required for POPIA evidence
- Scope: required events, storage path, and evidence capture expectations
- Hard requirements: least privilege; privacy by design; no content logging; time sync; retention controls
- Related docs: `03.30`, `03.40`, `50.*`, `21.35`, `30.*`
- Primary log store: OpenSearch on AI-DATA01 (or approved LAN-only equivalent)
- Time source: internal NTP alignment across all VMs
- Default stance: log action metadata, not file content
- Audience: Security, Platform Admins, Project Owners (read-only evidence)

## 1. Audit Logging Goals
- accountability for access and changes
- forensic reconstruction readiness
- operational visibility for abuse/misconfiguration
- POPIA-aligned data minimization

## 2. Event Taxonomy (Minimum Required)
Authentication/session:
- login success/failure
- MFA challenge success/failure (IdP path where SSO used)
- lockout/unlock
- password reset/change (local-user mode)
- session create/terminate when supported

Authorization/admin:
- user create/disable/delete (local mode)
- group create/rename/delete when applicable
- membership add/remove
- folder/share permission changes
- admin setting/policy changes

Content metadata events:
- file create/modify/delete/restore
- move/rename
- folder create/delete/rename
- internal share create/modify/revoke

External share events (high priority):
- public link creation
- link access when available
- permission/expiry modification
- revocation/expiry

Service/connector activity:
- service-account auth and token events
- indexer/automation summary activity
- unusual access patterns (excessive reads)

## 3. Required Structured Fields
- `@timestamp`
- `event.type`
- `event.action`
- `actor.user`
- `source.ip`
- `source.user_agent` (if available)
- `target.path` or stable target ID
- `target.projectcode` when derivable
- `result`
- `reason`
- `correlation_id`
- `tenant`

## 4. Log Sources and Collection Intent
Sources:
- Nextcloud app/activity logs
- AI-FRONTEND01 ingress logs for `nc.<domain>`
- IdP auth/MFA/token logs
- AI-DATA01 host security logs (`ssh`, `sudo`, `ufw`)

Collection intent:
- dedicated index families (`nextcloud-audit-*`, `nextcloud-access-*`, `idp-auth-*`, `host-security-*`)
- role-restricted audit visibility
- short-term local raw logs with rotation for integrity

## 5. Data Minimization and Privacy Controls
- never log document content
- avoid excessive PII beyond identifiers needed for accountability
- redact tokens/cookies/auth headers/secrets
- restrict audit index access to approved read-only roles

## 6. High-Value Alert Triggers
- repeated failed logins by IP/user
- abnormal successful-login source range
- admin/owner group membership changes
- external sharing policy toggles or public link creation
- mass delete/download behavior
- service-account read anomalies

## 7. Evidence Pack Standard
Bundle contents:
- ticket/incident reference
- time window with timezone
- actor identifiers and project code scope
- exported audit set (JSON/CSV)
- ingress log snippet
- IdP auth/MFA proof (SSO mode)
- change-proof screenshots and closeout summary

Recommended structure:

```text
/Evidence/Nextcloud-Audit/
  /<YYYY-MM>/
    /CASE-<ID>/
      01-Request-or-Incident.txt
      02-TimeWindow.txt
      03-Audit-Export.json
      04-Access-Logs.txt
      05-IdP-AuthProof.txt
      06-Screenshots/
      07-Conclusion.txt
```

## 8. Verification Checklist
- auth success/failure visibility present
- content metadata events present
- permission/group change events present
- external share events correlate with approvals
- sensitive headers/secrets redacted
- audit access restricted to read-only evidence role
- retention configured and documented

## 9. Client Rollout Variables
- auth mode and IdP audit source
- ingress and Nextcloud log source paths/indices
- index naming and retention windows
- audit reader role
- alerting tooling and thresholds
- redaction and PII handling rules
- evidence repository path
- quarterly sampling cadence
