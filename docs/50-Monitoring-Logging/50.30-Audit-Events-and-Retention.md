# AI Platform Deployment Documentation

## 50.30 Monitoring and Logging - Audit Events and Retention

LAN-only runtime • POPIA-friendly • Two-VM on Proxmox • Ubuntu 24.04  
Defines the audit event model across the platform and the retention/purge rules (no code).

## Document Control

| Field | Value |
|---|---|
| Document ID | `docs/50-Monitoring-Logging/50.30-Audit-Events-and-Retention` |
| Filename (target) | `docs/50-Monitoring-Logging/50.30-Audit-Events-and-Retention.md` |
| Version | `v1.0` |
| Date | `2026-02-09` |
| Owner | Choice IT / Security + Compliance |
| Status | Policy baseline |
| Scope | Audit event categories, minimum fields, storage location, access controls, and retention/purge rules |
| Hard requirements | Least privilege; tamper resistance; POPIA minimization; retention enforcement with evidence |
| Related docs | 03.30 Audit; 03.40 Retention; 04.* Identity; 21.45 Nextcloud audit; 40/41 automation |
| Primary audit sources | IdP, Gateway, Nextcloud, Automation tools, System layer |
| Primary audit store | On-prem centralized store (OpenSearch) OR secured file store; LAN-only |
| Time zone | Africa/Johannesburg |
| Evidence requirement | Quarterly access review + purge execution logs + incident evidence pack |
| Approver | Compliance Officer + Security |
| Note | Audit logs are evidence. Treat as write-once by default and restrict access |
| Lab defaults | AI-DATA01 `10.10.5.178`; AI-FRONTEND01 `10.10.5.179`; LAN `10.10.5.0/24` |
| Data minimization | Audit stores metadata and identifiers; never store content payloads unless explicitly approved |
| Legal hold | Supported via exception process in section 8 |

## Contents

- 1. Purpose of audit logging
- 2. Audit event taxonomy (what we record)
- 3. Minimum Audit Event Fields (standard schema)
- 4. Source systems and required events
- 5. Storage and integrity controls
- 6. Access controls and evidence workflows
- 7. Retention and Purge Policy
- 8. Exception process (Legal Hold)
- 9. Verification checklist
- 10. Client rollout variables (template)

## 1. Purpose of audit logging

- Provide a trustworthy record of "who did what, when, from where, and with what outcome".
- Enable investigations, incident response, and compliance reporting (POPIA).
- Support deterrence and accountability for privileged actions.
- Enable detection of misuse (abnormal patterns) without collecting unnecessary personal data.

## 2. Audit event taxonomy (what we record)

| Category | Examples | Priority |
|---|---|---|
| Authentication & Session | login success/failure, MFA success/failure, session start/end | P0 |
| Authorization & Role Changes | group membership changes, role mapping changes, privilege grants | P0 |
| Administrative Actions | config changes, user provisioning, app settings changes | P0 |
| Data Access (metadata) | file accessed, search executed, export performed (metadata-only) | P1 |
| Data Changes (metadata) | file upload/delete/move, permission changes, share created | P0/P1 |
| Automation Execution | workflow/script created/edited/run, credential changes | P0/P1 |
| System & Security Controls | sudo usage, SSH logins, firewall changes, service start/stop | P0 |
| Backup/DR Events | backup start/finish, restore start/finish, restore verification | P1 |

Priority guidance: P0 events must be captured for all enabled components. P1 events are captured when feasible without collecting sensitive payloads or introducing high-cardinality identifiers.

## 3. Minimum Audit Event Fields (standard schema)

- `timestamp` (ISO 8601, local time zone recorded)
- `source_system` (IdP, Gateway, Nextcloud, n8n, Windmill, OS, Backup)
- `event_category` (from taxonomy)
- `event_type` (e.g., `login_success`, `group_add`, `file_share_created`)
- `actor_id` (user id or service identity)
- `actor_type` (human/service)
- `actor_groups/roles` (at time of event, when available)
- `source_ip` (LAN IP; no geo enrichment required)
- `target_resource` (resource type + stable identifier; avoid names when they are sensitive)
- `action` (verb) and `outcome` (`success`/`fail`)
- `correlation_id` / `request_id` (for cross-system tracing where feasible)
- `reason` / `error_code` (sanitized)

Data minimization rule: store stable identifiers and metadata; avoid storing file names, document titles, and content unless explicitly approved.

## 4. Source systems and required events

### 4.1 Identity Provider (IdP)

- Logins (success/fail), MFA challenges, recovery code usage, session start/end.
- User lifecycle: create/disable/delete; password reset; MFA enrollment changes.
- Group membership and role mapping changes (especially admin/privileged groups).

### 4.2 Backend Gateway

- Auth token validation outcomes; access denied events; rate-limit triggers.
- Admin configuration changes (policy changes, allowlists, RBAC changes).
- Sensitive endpoint usage metadata (endpoint id, actor, outcome; no request body).

### 4.3 Nextcloud

- Permission and share changes (internal and external sharing exceptions).
- File operations metadata (upload/delete/move) at a level that supports investigations.
- Administrative changes to apps, sharing settings, and group folders.

### 4.4 Automation tools (n8n and Windmill)

- Workflow/script create/edit/delete; enable/disable; permission changes.
- Execution runs: actor, start/end time, status, duration; avoid logging payload content.
- Credential and secret reference changes (not secret material).

### 4.5 System layer (Ubuntu + UFW + SSH)

- SSH logins (success/fail), sudo usage (who ran what command), and privilege escalation events.
- UFW rules changes and service start/stop events.
- Key system updates (unattended upgrades) and package changes (metadata).

### 4.6 Backup/DR layer

- Backup jobs: start/end, status, data scope identifier, destination identifier (not secrets).
- Restore jobs: who initiated, what was restored (scope), validation results.

## 5. Storage and integrity controls

- Centralized store is recommended (OpenSearch) with restricted write paths and read-only auditor views.
- If file-based, store in an append-only directory structure with restricted permissions.
- Separate "ingest" role (write) from "audit" role (read-only).
- Enable time synchronization (NTP) to ensure consistent timestamps (LAN source).
- Use immutable backups or WORM-like storage for audit archives if available in the client environment.

## 6. Access controls and evidence workflows

- Security Admin: can query audit store for investigations; cannot delete audit data.
- Auditor (read-only): can view audit dashboards and export evidence packs under approval.
- Operator: limited operational visibility; cannot access sensitive audit indices by default.
- All access to audit views must itself be logged (meta-audit).

## 7. Retention and Purge Policy

Retention must be documented per log class and enforced with automated purge jobs plus evidence.

| Log type | Default retention | Access class | Purge method | Notes |
|---|---|---|---|---|
| Authentication/MFA audit | 180–365 days | Security, Auditors (RO) | Automated purge by index age | High value for investigations |
| Admin/role changes | 365 days | Security, Auditors (RO) | Automated purge by index age | Keep longer if policy requires |
| Automation executions metadata | 90–180 days | Ops (limited), Security | Automated purge by index age | No payloads; metadata only |
| File/share changes (metadata) | 180 days | Security, Auditors (RO) | Automated purge by index age | Align with retention requirements |
| System events (sudo/SSH/UFW) | 180–365 days | Security | Automated purge by index age | Baseline for hardening checks |

- Purge evidence must be retained (job logs, index deletion records).
- Retention exceptions require an approval record and an explicit end date.

## 8. Exception process (Legal Hold)

1. Trigger: legal hold or investigation requires longer retention.
2. Approval: Compliance Officer + Security approve scope and duration.
3. Action: isolate affected audit records into a protected archive (read-only).
4. Review: at end date, either extend with new approval or return to normal purge policy.

## 9. Verification checklist

- PASS: All P0 event categories are captured from enabled components.
- PASS: Audit events include minimum fields (actor, timestamp, source, outcome).
- PASS: No secret material or sensitive content payloads appear in audit logs.
- PASS: Access to audit dashboards/indices is least-privilege and reviewed quarterly.
- PASS: Automated purge runs on schedule and purge evidence is retained.
- PASS: Legal hold process tested (tabletop) and documented.

## 10. Client rollout variables (template)

| Variable | Value |
|---|---|
| Central audit store (OpenSearch / File-based) | `<fill>` |
| Audit store host | `<fill>` |
| Auditor group members (RO) | `<fill>` |
| Security admin group members | `<fill>` |
| Authentication audit retention (days) | `<fill>` |
| Admin change retention (days) | `<fill>` |
| Automation execution retention (days) | `<fill>` |
| File/share change retention (days) | `<fill>` |
| System event retention (days) | `<fill>` |
| Purge job schedule | `<fill>` |
| Legal hold approvers | `<fill>` |
| Evidence pack storage location | `<fill>` |
