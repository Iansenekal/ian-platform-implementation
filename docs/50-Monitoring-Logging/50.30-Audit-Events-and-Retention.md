# AI Platform Deployment Documentation

## 50.30 Monitoring and Logging - Audit Events and Retention

LAN-only runtime • POPIA-friendly • Two-VM on Proxmox • Ubuntu 24.04
Defines the audit event model across the platform and the retention/purge rules.

## Document Control

| Field | Value |
|---|---|
| Document ID | `docs/50-Monitoring-Logging/50.30-Audit-Events-and-Retention` |
| Filename | `docs/50-Monitoring-Logging/50.30-Audit-Events-and-Retention.md` |
| Version | `v1.0` |
| Date | `2026-02-09` |
| Owner | Choice IT / Security + Compliance |
| Status | Policy baseline |
| Scope | Audit taxonomy, minimum fields, storage, access controls, retention/purge |
| Hard requirements | Least privilege, tamper resistance, POPIA minimization, retention evidence |
| Primary audit store | On-prem OpenSearch or secured file store (LAN-only) |
| Time zone | Africa/Johannesburg |
| Evidence | Quarterly access review + purge logs + incident evidence pack |

## 1) Purpose

- Record who did what, when, from where, with what outcome.
- Support POPIA investigations and accountability.
- Detect misuse without collecting unnecessary payload data.

## 2) Audit Taxonomy

| Category | Examples | Priority |
|---|---|---|
| Authentication & Session | login success/failure, MFA, session start/end | P0 |
| Authorization & Role Changes | group membership, role mapping, privilege grants | P0 |
| Administrative Actions | config changes, user provisioning, app settings changes | P0 |
| Data Access (metadata) | file accessed, search executed, export metadata | P1 |
| Data Changes (metadata) | upload/delete/move, permission/share changes | P0/P1 |
| Automation Execution | workflow/script create/edit/run, credential ref changes | P0/P1 |
| System & Security Controls | sudo, SSH, UFW changes, service lifecycle | P0 |
| Backup/DR Events | backup/restore start/end and validation | P1 |

P0 events are mandatory for all enabled components.

## 3) Minimum Audit Event Fields

- `timestamp` (ISO 8601)
- `source_system`
- `event_category`
- `event_type`
- `actor_id`
- `actor_type`
- `actor_groups/roles` (where available)
- `source_ip`
- `target_resource`
- `action`
- `outcome`
- `correlation_id` / `request_id` (where feasible)
- `reason` / `error_code` (sanitized)

Data minimization: prefer stable identifiers over sensitive names; never store content payloads by default.

## 4) Source Systems and Required Events

- IdP: auth, MFA, recovery, user lifecycle, role/group changes.
- Gateway: token validation, access deny, rate-limit, admin policy changes.
- Nextcloud: file/share/permission/admin changes metadata.
- n8n/Windmill (if enabled): workflow lifecycle, execution metadata, credential reference changes.
- System (Ubuntu/UFW/SSH): SSH success/fail, sudo, firewall changes, updates.
- Backup/DR: backup/restore job metadata and validation outcomes.

## 5) Storage and Integrity Controls

- Prefer centralized OpenSearch with restricted ingest/read roles.
- If file-based, use append-only directory controls and strict permissions.
- Separate ingest role (write) from audit role (read-only).
- Keep NTP synchronized for reliable timeline correlation.
- Use immutable/WORM-style archives where available.

## 6) Access Controls and Evidence Workflows

- Security Admin: investigation query access, no deletion rights.
- Auditor (RO): dashboard/evidence export under approval.
- Operator: limited operational visibility.
- Access to audit views must itself be logged (meta-audit).

## 7) Retention and Purge Policy

| Log type | Default retention | Access class | Purge method |
|---|---|---|---|
| Authentication/MFA | 180-365 days | Security + Auditors (RO) | Automated purge by age |
| Admin/role changes | 365 days | Security + Auditors (RO) | Automated purge by age |
| Automation execution metadata | 90-180 days | Ops limited + Security | Automated purge by age |
| File/share metadata | 180 days | Security + Auditors (RO) | Automated purge by age |
| System events (sudo/SSH/UFW) | 180-365 days | Security | Automated purge by age |

- Purge evidence must be retained.
- Retention exceptions require explicit approval and end date.

## 8) Exception Process (Legal Hold)

1. Trigger legal hold scope.
2. Obtain Compliance Officer + Security approval.
3. Isolate affected audit records in protected read-only archive.
4. At end date, extend with approval or return to normal purge policy.

## 9) Verification Checklist

- PASS: all P0 categories captured for enabled systems.
- PASS: minimum fields present in sampled events.
- PASS: no secret material or payload content in audit logs.
- PASS: least-privilege access with quarterly access review evidence.
- PASS: purge jobs run on schedule and purge evidence retained.
- PASS: legal hold tabletop documented.

## 10) Client Rollout Variables

| Variable | Value |
|---|---|
| Central audit store | `<OpenSearch|File-based>` |
| Audit store host | `<host>` |
| Auditor group (RO) | `<members>` |
| Security admin group | `<members>` |
| Authentication retention days | `<days>` |
| Admin change retention days | `<days>` |
| Automation retention days | `<days>` |
| File/share retention days | `<days>` |
| System event retention days | `<days>` |
| Purge schedule | `<cron/schedule>` |
| Legal hold approvers | `<names>` |
| Evidence pack location | `<path>` |
