# AI Platform Deployment Documentation

## 04.70 Break-Glass & Recovery Standard

LAN-only • POPIA-friendly • Two-VM on Proxmox • Ubuntu 24.04
Emergency access design, custody controls, recovery workflows, and mandatory testing.

## Document Control

| Field | Value |
|---|---|
| Document ID | `docs/04-Identity-Access-MFA/04.70-BreakGlass-Recovery` |
| Filename (target) | `docs/04-Identity-Access-MFA/04.70-BreakGlass-Recovery.md` (Word-authored equivalent) |
| Version | `v1.0` |
| Date | `2026-02-09` |
| Owner | Choice IT / Client Delivery Team |
| Status | Mandatory standard; required for client production go-live |
| Install Order Position | After 04.60 SSO Matrix; before 04.90 verification checklist; implemented during 11.* IdP deployment |
| Applies to | Identity Provider, Gateway, UI, Nextcloud, Search/Graph, monitoring, optional automation modules |
| Primary requirement | A safe, auditable emergency access method when normal admin access is unavailable |
| Related docs | 04.30 MFA Policy; 03.30 Audit Logging; 03.40 Retention; 05.30 Incident Response; 06.* Backup/Restore |
| Security note | Break-glass use must be rare, time-bound, and reviewed; credentials stored offline in two-person custody |
| Change control | Break-glass configuration changes require approval and scheduled testing |

## Contents

- 1. Purpose and outcomes
- 2. Break-glass principles (must-follow rules)
- 3. Break-glass account design (how many, where, and what permissions)
- 4. Custody and storage model (two-person rule)
- 5. Allowed break-glass scenarios (what qualifies)
- 6. Emergency access runbooks (step-by-step)
- 6.1 All admins locked out / MFA outage
- 6.2 IdP misconfiguration prevents logins
- 6.3 Internal CA/TLS failure blocks admin access
- 6.4 AD outage (in AD mode)
- 7. Post-incident mandatory actions (containment and audit)
- 8. Testing standard (quarterly drill)
- 9. Verification checklist (mandatory)
- 10. Client rollout variables (template)

## 1. Purpose and outcomes

Break-glass access is an emergency-only mechanism that allows recovery when normal administrative access is unavailable (for example: all admin accounts are locked out, MFA service is misconfigured, or IdP admin console is unreachable).

This document defines how break-glass is designed, stored, used, and tested so that it strengthens resiliency without weakening security.

Outcomes:

- A safe break-glass design that does not create an always-on backdoor.
- Two-person custody and strict usage rules aligned to POPIA and least privilege.
- Clear, step-by-step runbooks for the most common recovery scenarios.
- A mandatory quarterly test and evidence checklist.

## 2. Break-glass principles (must-follow rules)

- BG1: Break-glass accounts are for emergencies only; never for daily operations.
- BG2: Store break-glass credentials offline in sealed custody; no storage in chat, email, or plaintext documents.
- BG3: Two-person rule: at least two custodians are required to retrieve and use break-glass credentials.
- BG4: Time-bound access: break-glass is enabled/used only long enough to restore normal admin access.
- BG5: Least privilege: break-glass permissions are the minimum needed to recover IdP access and platform administration.
- BG6: Mandatory auditing: break-glass usage triggers incident response documentation and post-incident review.
- BG7: Mandatory testing: quarterly drill with recorded evidence and sign-off.

## 3. Break-glass account design (how many, where, and what permissions)

### 3.1 Minimum recommended set

- `BG-IdP-Admin`: an IdP administrative account used to fix identity configuration (Tier-0).
- `BG-Platform-Admin`: a platform administrative account used to restore admin access to the system (Tier-0).

Rule: keep the number of break-glass accounts as small as possible. Two is usually sufficient.

### 3.2 Permission boundaries

- `BG-IdP-Admin`: can modify IdP configuration, MFA policies, client registrations, group mappings, and admin users.
- `BG-Platform-Admin`: can restore access to admin routes, rotate secrets, restart services, and apply emergency firewall adjustments if required.
- Neither break-glass account should have routine access to user data beyond what is required for recovery.

### 3.3 MFA stance for break-glass

- Default: Break-glass accounts should still be protected by MFA where feasible.
- If the emergency scenario is specifically an MFA outage/misconfiguration, break-glass may be configured with alternative controlled access (e.g., recovery codes stored offline).
- Any reduction in MFA is temporary and must be reversed immediately after recovery.

## 4. Custody and storage model (two-person rule)

### 4.1 Two-person custody design

- Custodian A and Custodian B hold separate parts of the recovery material (or separate sealed envelopes) to reduce single-person misuse.
- Both custodians must be available to open the sealed materials.
- Custodians should be senior staff with background checks where possible.

### 4.2 Storage options (approved)

- Sealed envelope stored in a physical safe (preferred).
- Two sealed envelopes stored in two separate secure locations.
- Approved enterprise secret vault with break-glass procedure (only if LAN-only and access is controlled).

### 4.3 What must be stored (minimum)

- Break-glass usernames (`BG-IdP-Admin`, `BG-Platform-Admin`).
- Passwords (or recovery codes if used).
- If MFA is required: backup MFA method or recovery codes.
- Emergency hostnames/URLs for admin access (`id.<domain>`, `ui.<domain>` admin routes).
- A printed copy of the runbook steps and verification checklist.

## 5. Allowed break-glass scenarios (what qualifies)

- All admin accounts locked out (password policy, lockout threshold, or accidental disable).
- MFA service misconfiguration prevents admin access.
- IdP misconfiguration breaks OIDC flows (redirect URI errors, invalid client secret, broken group mapping).
- TLS certificate/CA issue blocks browser access to admin consoles.
- AD outage in AD-integrated mode prevents admin logins and no alternative admin path is available.

Not allowed: routine maintenance, convenience logins, or bypassing normal change control.

## 6. Emergency access runbooks (step-by-step)

Each runbook below includes: what terminal/app to use, what to verify, and what to document. All actions must be recorded under an incident ticket/reference.

### 6.1 Scenario: All admins locked out / MFA outage

Step 1 - Open incident record

1. Create an incident ticket in the client's ticketing system (or a written incident log if none exists).
2. Record: date/time, impacted services, who is responding, and reason for break-glass.

Step 2 - Retrieve break-glass credentials (two-person custody)

3. Custodian A and B meet physically (or per approved process).
4. Retrieve sealed materials; record seal condition and time of opening.
5. Do not photograph or email credentials.

Step 3 - Access admin route from allowed admin network (Zone E)

Application: Browser from an allowlisted admin workstation in Zone E.

- Navigate to `https://id.<domain>` (published via AI-FRONTEND01) and open the admin console route.
- Login with `BG-IdP-Admin`.

Verification (terminal: SSH to AI-FRONTEND01):

```bash
sudo ufw status verbose
sudo ss -tulpn | grep ':443'
```

Expected: admin access originates from allowlisted Zone E.

Step 4 - Restore normal admin access

- If lockout: unlock admin accounts and confirm they can log in.
- If MFA misconfigured: correct MFA enforcement settings (restore to standard 04.30).
- If group mappings broken: restore `AI-PLATFORM-ADMINS` mapping.
- Rotate any affected secrets if compromise is suspected.

Verification: test login for a normal admin account and confirm MFA works.

Step 5 - Disable/retire break-glass session

- Log out of break-glass account.
- Re-seal updated credentials if password was rotated; update custody record.
- Ensure break-glass account is not left with relaxed MFA settings.

### 6.2 Scenario: IdP misconfiguration prevents logins (OIDC broken)

6. Open incident ticket and retrieve break-glass credentials (two-person custody).
7. From Zone E admin workstation, login to IdP admin console using `BG-IdP-Admin`.
8. Check recent changes: client secrets, redirect URIs, issuer URLs, group claims mappings.
9. Restore the last-known-good configuration (use documented configuration baseline).
10. Verify UI login works (`https://ui.<domain>`) and tokens validate at Gateway.
11. Audit: export change log and attach to incident record.

Verification (terminal: SSH to AI-FRONTEND01):

```bash
curl -vk https://ui.<domain>/
curl -vk https://id.<domain>/
```

Verification (terminal: SSH to AI-DATA01):

```bash
sudo journalctl -u docker --no-pager | tail -n 100
```

### 6.3 Scenario: Internal CA/TLS failure blocks admin access

12. Open incident ticket and retrieve break-glass credentials (two-person custody).
13. Verify whether issue is DNS, certificate expiry, or CA trust distribution.
14. If certificate expired: re-issue internal TLS certificate and redeploy to AI-FRONTEND01 routes.
15. If CA trust broken: re-install CA root certificate on admin workstation and servers.
16. Verify browser access to `https://ui.<domain>` and `https://id.<domain>` without warnings.
17. Confirm all admin roles still require MFA; do not bypass TLS verification except as a last resort with documented risk acceptance.

Verification (terminal: SSH to AI-FRONTEND01):

```bash
openssl x509 -in /path/to/cert.pem -noout -dates || true
sudo systemctl status docker
```

### 6.4 Scenario: AD outage (AD mode) prevents admin logins

18. Open incident ticket and confirm AD/DC outage and expected recovery time.
19. If IdP supports cached sessions: test existing admin sessions for continuity.
20. Use break-glass IdP admin to temporarily enable a local admin account (time-bound) if required.
21. Restore AD connectivity (network/DNS/time).
22. Return IdP to normal AD-integrated operation and disable temporary local admin.
23. Audit all changes and rotate secrets if necessary.

Verification: Ensure AD is reachable from AI-DATA01 (terminal: SSH).

```bash
nc -vz <DC_HOSTNAME_OR_IP> 636
```

## 7. Post-incident mandatory actions (containment and audit)

- PI1: Document all actions taken, times, and who performed them (incident record).
- PI2: Export IdP audit logs for the break-glass window and store as evidence (retention per 03.40).
- PI3: Rotate break-glass passwords and/or regenerate recovery codes if they were exposed.
- PI4: Verify MFA policy returned to the standard baseline (04.30).
- PI5: Review UFW and routing to ensure no temporary openings remain.
- PI6: Conduct a post-incident review with custodians and platform owners; record lessons learned.

## 8. Testing standard (quarterly drill)

### 8.1 Test cadence and scope

- Frequency: quarterly (every 3 months) minimum.
- Scope: at least one recovery scenario must be simulated (non-production preferred).
- Evidence: screenshots/log extracts of successful recovery and verification steps (stored securely).
- Sign-off: custodians + platform owner sign the test record.

### 8.2 Drill steps (recommended)

24. Choose a test scenario (e.g., lock out a test admin account).
25. Open a test incident ticket.
26. Retrieve break-glass materials with two-person custody (simulate in non-prod).
27. Perform recovery steps and restore normal admin access.
28. Rotate break-glass credentials after the drill.
29. Store evidence and close ticket with sign-off.

## 9. Verification checklist (mandatory)

- Break-glass accounts exist and are disabled from routine use (or tightly controlled).
- Two-person custody materials exist and are stored securely.
- Admin routes require Zone E allowlist and MFA (where feasible).
- A quarterly drill has been performed and evidence exists.
- Post-incident actions are documented for any break-glass usage (audit export, rotation, review).

### 9.1 Suggested verification commands

Application/terminal: SSH to AI-FRONTEND01 and AI-DATA01.

```bash
sudo ufw status verbose
sudo systemctl status docker
sudo journalctl -u docker --no-pager | tail -n 50
```

## 10. Client rollout variables (template)

| Variable | Value |
|---|---|
| Client name | `<ClientName>` |
| Internal domain | `<client.local>` |
| Break-glass accounts | `BG-IdP-Admin, BG-Platform-Admin` |
| Custodian A | `<name/role>` |
| Custodian B | `<name/role>` |
| Storage method | `Safe / sealed envelopes / vault` |
| Admin allowlist (Zone E) | `<CIDR/IP list>` |
| MFA for break-glass | `Enabled where feasible; recovery codes stored offline` |
| Quarterly drill schedule | `<dates>` |
| Incident log system | `<ticketing system>` |
| Break-glass password rotation cadence | `After every use + quarterly drill` |
| Evidence storage location | `<secure location>` |
| IdP audit export retention | `Per 03.40` |
| Break-glass usage approval rule | `Two-person custody + incident ticket` |
| Temporary local admin allowed (AD outage)? | `Yes/No (time-bound)` |
| Post-incident review owner | `<name/role>` |
| Post-incident checklist use | `Mandatory` |
| Emergency contact list | `<names/phones>` |
| Non-prod drill environment available? | `Yes/No` |
| Last drill date | `<date>` |
