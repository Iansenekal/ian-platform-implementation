# AI Platform Deployment Documentation

## 04.20 Authentication Modes - AD Integrated vs Local Users

LAN-only • POPIA-friendly • Two-VM on Proxmox • Ubuntu 24.04
Decision tree, prerequisites, procedures, and verification commands.

## Document Control

| Field | Value |
|---|---|
| Document ID | `docs/04-Identity-Access-MFA/04.20-Auth-Modes-AD-vs-LocalUsers` |
| Filename | `docs/04-Identity-Access-MFA/04.20-Auth-Modes-AD-vs-LocalUsers.md` |
| Version | `v1.0` |
| Date | `2026-02-09` |
| Owner | Choice IT / Client Delivery Team |
| Status | Mandatory design + implementation standard |
| Install order | After 04.10; before 04.30 and 11.* |
| Primary requirement | Support AD-integrated and no-directory clients |
| Security note | LDAPS mandatory in AD mode; stronger lifecycle controls in local mode |

## 1) Purpose and Outcomes

Defines supported auth modes:

- Mode A: AD Integrated (preferred).
- Mode B: Local Users (no directory service).

Outcomes:

- Simple mode-selection decision rule.
- Consistent group naming/role mapping across both modes.
- Verified procedures for each mode.
- Safe migration posture between modes.

## 2) Quick Decision Summary

- If client has on-prem AD: choose Mode A.
- If client has no directory: choose Mode B.
- If Entra-only with strict LAN-only runtime: prefer Mode A only if on-prem AD exists, otherwise Mode B with roadmap.
- Avoid mixed mode unless migration is documented with target end-state and cutover date.

## 3) Shared Baseline (Both Modes)

- Normal users authenticate through AI-FRONTEND01:443 only.
- IdP is the single source for auth, MFA, sessions, and claims.
- Gateway validates tokens and enforces authorization.
- MFA mandatory for privileged roles.
- Identity events are audited.
- Group naming is stable and documented.

## 4) Mode A - AD Integrated (Preferred)

### 4.1 Prerequisites

- On-prem AD available.
- DNS and time sync healthy.
- LDAPS available on TCP 636.
- IdP trust store includes DC issuing CA.
- Least-privilege bind account exists.

### 4.2 AD group design

Baseline groups:

- `AI-PLATFORM-ADMINS`
- `AI-SECURITY-AUDITORS`
- `AI-USERS-STANDARD`
- `AI-USERS-POWER`
- `AI-USERS-READONLY`
- `AI-AUTOMATION-OPERATORS` (optional)
- `AI-BREAKGLASS-OWNERS`

Project groups:

- `AI-NC-PROJ-<CODE>-VIEW|EDIT|OWNER`
- `AI-SEARCH-PROJ-<CODE>-QUERY`

### 4.3 Service account controls

- Dedicated bind account (example: `svc_ai_idp_ldap`).
- Read-only permissions and restricted OU scope.
- Credential treated as secret and rotated (default 90 days).

### 4.4 LDAPS controls

- LDAPS only (`636`), no plaintext LDAP (`389`) for auth.
- Validate cert chain and expiry before IdP config.

### 4.5 AD mode procedure summary

1. Validate DNS records (`ui/id/api`).
2. Validate time sync on both VMs.
3. Validate TCP reachability to DC:636.
4. Validate LDAPS certificate chain.
5. Create baseline/project groups and test users.
6. Configure IdP directory connection and mapping.
7. Verify logins, claims, MFA, and access boundaries.

### 4.6 AD mode verification

- Standard user: login success, standard scope.
- Read-only: edit denied.
- Admin/Auditor: MFA required, admin from Zone E only.
- Audit logs include login/MFA/group-change events.
- Direct normal LAN access to AI-DATA01 identity endpoints blocked.

## 5) Mode B - Local Users

### 5.1 When to use

- No AD/directory service exists.
- Early-stage deployment with future directory roadmap.

### 5.2 Password lifecycle controls

- Min length 14, complexity, no reuse.
- Lockout policy enforced.
- Approval-based onboarding.
- Immediate offboarding + session revocation.
- Monthly access review mandatory.

### 5.3 Group/role management

- Same group names as AD mode.
- Group-based permissions only; avoid per-user exceptions.
- Minimize platform admin count.

### 5.4 Local mode procedure summary

1. Confirm boundary checks (`frontend 443` reachable, backend blocked).
2. Create baseline and project groups in IdP.
3. Create test users and assign groups.
4. Enforce MFA by tier.
5. Validate claims model used by gateway/UI/Nextcloud.

### 5.5 Local mode verification

- Standard/read-only/admin/auditor behavior matches policy.
- Admin/Auditor MFA enforced.
- Identity admin/group/MFA events audited.
- Monthly access review scheduled and evidenced.

## 6) Migration Notes

### 6.1 Local -> AD (preferred)

- Keep identical group names.
- Create matching AD groups.
- Pilot mapped AD users.
- Cut over and disable local identities after validation.

### 6.2 AD -> Local (exception)

- Controlled cutover only.
- Recreate users/groups with MFA.
- Increase review frequency post-cutover.

## 7) Threats and Mitigations

| Threat | AD mode mitigations | Local mode mitigations |
|---|---|---|
| LDAP interception | LDAPS required, block 389 | n/a |
| Over-privileged bind account | read-only bind, OU scope | n/a |
| Lifecycle drift | AD governance process | strict onboarding/offboarding + monthly review |
| Admin console exposure | Zone E allowlist + MFA + audit | same |
| Group mapping abuse | change approval + audit | change approval + audit |

## 8) Client Rollout Variables

| Variable | Value |
|---|---|
| Client name | `<ClientName>` |
| Auth mode | `AD Integrated` or `Local Users` |
| Internal domain | `<client.local>` |
| DNS servers | `<IPs>` |
| Published hostnames | `<id/ui/api>` |
| Zone E allowlist | `<CIDR/IP list>` |
| MFA methods | `TOTP; WebAuthn optional` |
| MFA tiers | `Admins/Auditors mandatory` |
| Baseline groups | `AI-PLATFORM-ADMINS, AI-SECURITY-AUDITORS, AI-USERS-*` |
| Project codes | `<list>` |
| AD domain/LDAPS/Base DN | `<AD values if Mode A>` |
| Bind account | `<svc_ai_idp_ldap if Mode A>` |
| Bind rotation | `90 days default` |
| Local password policy | `min 14 + complexity + lockout` |
| Local access review cadence | `monthly` |
| Break-glass owners | `<two-person custody>` |
| Audit review owner | `<name/role>` |
