# AI Platform Deployment Documentation

## 04.40 Role Model, RBAC & Groups

LAN-only • POPIA-friendly • Two-VM on Proxmox • Ubuntu 24.04
Roles, group naming, permissions matrix, Nextcloud granular roles, and cross-app mapping standard.

## Document Control

| Field | Value |
|---|---|
| Document ID | `docs/04-Identity-Access-MFA/04.40-RoleModel-RBAC-Groups` |
| Filename (target) | `docs/04-Identity-Access-MFA/04.40-RoleModel-RBAC-Groups.md` (Word-authored equivalent) |
| Version | `v1.0` |
| Date | `2026-02-09` |
| Owner | Choice IT / Client Delivery Team |
| Status | Mandatory RBAC standard; defines roles and groups across the platform |
| Install Order Position | After 04.30 MFA; before 04.60 SSO Matrix; implemented during 11.* IdP + 21.* Nextcloud + 30.* Search |
| Applies to | Identity Provider, Gateway, UI, Nextcloud, Search/Graph, optional n8n/Windmill, dashboards |
| Primary requirement | Granular permissions; least privilege; consistent group naming; AD or Local Users compatible |
| Related docs | 03.10 Least Privilege; 03.30 Audit Logging; 21.35 Nextcloud Permissions; 30.15 ACL Inheritance; 10.50 Gateway Authorization |
| Security note | Admin roles are allowlisted + MFA mandatory; group mapping changes are audited |
| Change control | RBAC changes require approval and must be versioned/documented |

## Contents

- 1. Purpose and outcomes
- 2. RBAC principles (must-follow rules)
- 3. Role tiers (platform-wide)
- 4. Group naming convention (global and project groups)
- 5. Permissions matrix (what each role can do)
- 6. Nextcloud granular roles (Admin, User, Read-Only, Project roles)
- 7. Cross-application mapping model (IdP -> claims -> Gateway -> apps)
- 8. Project folder ACL blueprint alignment (preview)
- 9. Governance: onboarding/offboarding and access reviews
- 10. Audit requirements for RBAC changes
- 11. Verification checklist (mandatory)
- 12. Client rollout variables (template)

## 1. Purpose and outcomes

This document defines the platform's Role-Based Access Control (RBAC) standard. It specifies:

- The role tiers used across all modules.
- The required group naming convention (AD or Local Users).
- A permissions matrix for each role.
- Nextcloud-specific granular permission roles (Admin/User/Read-Only and project-level roles).
- How roles and groups flow through IdP claims to the Gateway and apps.

The goal is predictable, least-privilege access that can be audited and scaled across many projects.

Outcomes:

- A unified list of roles that every module understands.
- A stable group naming convention that works in AD-integrated and local-user deployments.
- A practical permissions matrix for platform functions, Nextcloud, Search/Graph, and automation tools.
- A repeatable onboarding/offboarding and access review process.

## 2. RBAC principles (must-follow rules)

- R0: Deny-by-default. If a user is not in a group that grants access, access is denied.
- R1: Roles are granted via groups, not per-user exceptions.
- R2: Separate duties: Admin, Security Auditor, and Ops should be distinct where possible.
- R3: Project access is explicit via project groups (VIEW/EDIT/OWNER).
- R4: Read-Only is a first-class role, not an afterthought (supports auditors and least privilege).
- R5: Group mapping changes are privileged actions and must be audited.
- R6: Admin roles require MFA and admin allowlist (Zone E).
- R7: Search and mind-map visibility inherit from source ACLs. No leakage via metadata.

## 3. Role tiers (platform-wide)

These are the minimum required roles. Clients may add roles, but must not weaken these definitions.

| Role | Purpose | Typical members | MFA required? | Notes |
|---|---|---|---|---|
| Platform Admin | Full platform administration | Senior IT admins | Yes (mandatory) | Small set only; named accounts |
| IdP Admin | Identity provider configuration | Identity admins | Yes (mandatory) | May be same as Platform Admin in small orgs |
| Security Auditor | Read-only security evidence access | Security/compliance team | Yes (mandatory) | No config changes |
| Ops / SRE | Day-2 operations, deployments, upgrades | Ops team | Recommended | No identity changes unless delegated |
| Project Owner | Manages access within a project scope | Business/project leads | Recommended | Cannot alter platform-wide settings |
| Power User | Advanced features, ingestion tools | Power users | Optional | May trigger workflows |
| Standard User | Normal usage | Most users | Optional | Default user tier |
| Read-Only User | View-only access | Guests/auditors | Optional | No edits; limited downloads per policy |
| Automation Operator | Manages n8n/Windmill workflows | Automation admins | Recommended/Optional | Optional modules only |
| Break-Glass Admin | Emergency recovery only | Two custodians | Yes (mandatory) | Stored offline; tested per 04.70 |

## 4. Group naming convention (global and project groups)

### 4.1 Global groups (minimum set)

- `AI-PLATFORM-ADMINS`
- `AI-IDP-ADMINS` (optional if separated)
- `AI-SECURITY-AUDITORS`
- `AI-OPS-SRE` (optional)
- `AI-USERS-POWER`
- `AI-USERS-STANDARD`
- `AI-USERS-READONLY`
- `AI-AUTOMATION-OPERATORS` (optional; if n8n/Windmill enabled)
- `AI-BREAKGLASS-OWNERS` (small set)

### 4.2 Project group template (per project code `<CODE>`)

Project code examples: `BANANA`, `NIGHTPENGUIN`, `DADJOKE`, `LASAGNA`, `CHUCKNORRIS` (from SharePoint layout).

Nextcloud project access groups:

- `AI-NC-PROJ-<CODE>-VIEW`
- `AI-NC-PROJ-<CODE>-EDIT`
- `AI-NC-PROJ-<CODE>-OWNER`

Search/Knowledge Graph scope groups:

- `AI-SEARCH-PROJ-<CODE>-QUERY`

Optional automation scope groups (if needed):

- `AI-AUTO-PROJ-<CODE>-RUN`

Rule: project membership is explicit. Users do not inherit project access from being a Standard User.

### 4.3 Source-specific connector groups (optional)

- If connecting to external repositories (SharePoint/Teams/OneDrive), define connector-specific access groups where needed:
- `AI-SP-PROJ-<CODE>-VIEW/EDIT` (optional)

The platform should still enforce visibility using the original source ACLs (30.15).

## 5. Permissions matrix (what each role can do)

This matrix is the baseline. Module-specific docs may add detail but may not weaken these restrictions.

| Capability | Platform Admin | IdP Admin | Security Auditor | Ops/SRE | Project Owner | Power User | Standard | Read-Only | Automation Operator |
|---|---|---|---|---|---|---|---|---|---|
| Manage IdP config / SSO clients | Yes | Yes | No | No | No | No | No | No | No |
| View audit logs and security dashboards | Yes | Yes (identity only) | Yes (read-only) | Limited | Limited (project scope) | Limited | Limited | Limited | No |
| Manage platform-wide UFW/ports | Yes | No | No | Yes (if delegated) | No | No | No | No | No |
| Create/disable users | Yes | Yes (in local mode) | No | No | No | No | No | No | No |
| Assign users to global groups | Yes | Yes | No | Limited (if delegated) | No | No | No | No | No |
| Manage project membership (project groups) | Yes | Limited | No | Limited | Yes | No | No | No | No |
| Create/manage Nextcloud project folders | Yes | No | No | Limited | Yes (within project) | Limited | No | No | No |
| Upload/edit project content (Nextcloud) | Yes | No | No | No | Yes (project scope) | Yes | Yes | No | No |
| View/download project content (Nextcloud) | Yes | No | Yes (as needed) | Yes | Yes | Yes | Yes | Yes (view only) | No |
| Search across permitted sources | Yes | Yes | Yes | Yes | Yes | Yes | Yes | Yes (limited) | Yes (workflows only) |
| Run ingestion/indexing jobs | Yes | No | No | Yes (if delegated) | Limited | Yes | Limited | No | Yes (optional) |
| Manage n8n/Windmill platform settings | Yes | No | No | No | Limited | No | No | No | Yes |
| Create/edit workflows (n8n/Windmill) | Yes | No | No | No | Limited | Limited | No | No | Yes |

Notes:

- `Limited` means only within delegated scope and never for platform-wide security settings.
- Security Auditor is read-only by design.
- Project Owner can manage access within their project (subject to policy) but cannot grant platform admin rights.

## 6. Nextcloud granular roles (Admin, User, Read-Only, Project roles)

Nextcloud permissions must be granular and group-driven. Nextcloud should not become a wild-west file share.

| Nextcloud Role | Who | Group mapping example | Capabilities | Sharing stance | Notes |
|---|---|---|---|---|---|
| Nextcloud Admin | Platform Admin or delegated Nextcloud admin | `AI-PLATFORM-ADMINS` / `AI-NC-ADMINS` | Full admin in Nextcloud | External sharing disabled by default | MFA mandatory; allowlist |
| Nextcloud User (Standard) | Most users | `AI-USERS-STANDARD` | Use Nextcloud within allowed project folders | Internal sharing allowed within project | No external shares by default |
| Nextcloud Power User | Power users | `AI-USERS-POWER` | Advanced features (tagging, ingestion helpers) | Internal only | May trigger indexing workflows |
| Nextcloud Read-Only | Auditors/guests | `AI-USERS-READONLY` | View/download only where permitted | No sharing | No edits; no uploads by default |
| Project Owner (Nextcloud) | Project leads | `AI-NC-PROJ-<CODE>-OWNER` | Manage membership within project folder + structure | Internal sharing within project | Cannot override platform global policies |
| Project Editor | Project team members | `AI-NC-PROJ-<CODE>-EDIT` | Upload/edit within project folder | Internal sharing within project | No admin |
| Project Viewer | Stakeholders | `AI-NC-PROJ-<CODE>-VIEW` | View/download within project folder | No sharing by default | Visibility only |

### 6.2 Nextcloud permission rules (mandatory)

- NC1: Every project has a dedicated root folder with group-based ACLs (VIEW/EDIT/OWNER).
- NC2: External sharing is disabled by default and requires an exception (21.38).
- NC3: Link shares must have expiry dates if enabled; events are audited.
- NC4: Admins do not grant access directly to individuals; access is via groups.
- NC5: Folder permissions must align with search/knowledge graph ACL inheritance (30.15).

## 7. Cross-application mapping model (IdP -> claims -> Gateway -> apps)

- IdP is the source of truth for identity and group membership (AD-derived or local).
- IdP issues tokens/claims that include group memberships (or role claims derived from groups).
- Gateway validates the token and translates group claims into platform roles and project scopes.
- Apps (UI, Search, Nextcloud integration points, automation tools) consume only the Gateway or IdP standards, not raw directory access.
- If a user's group membership changes, access changes must take effect quickly (token/session refresh policy).

## 8. Project folder ACL blueprint alignment (preview)

Project folder ACLs are defined in detail in 21.37 (Nextcloud) and 30.15 (Search). Required alignment:

- Project folder membership (VIEW/EDIT/OWNER) is the primary source of project access truth.
- Search results and mind-map nodes must never show items outside the user's VIEW permission.
- Metadata is sensitive: file names, paths, tags, and cross-project links must be hidden if the user lacks permission.
- Cross-project linking in the mind-map is shown only when the user can see both sides of the link.

## 9. Governance: onboarding/offboarding and access reviews

### 9.1 Onboarding

1. Create/enable account (via AD or local IdP).
2. Assign baseline group (Standard/Read-Only/Power).
3. Assign project group(s) (VIEW/EDIT/OWNER) per project membership request.
4. Enroll MFA if required by tier.
5. Verify access with user (minimal test).
6. Ensure audit events are recorded.

### 9.2 Offboarding

7. Disable account immediately.
8. Revoke active sessions/tokens.
9. Remove from project groups (or disable account handles this).
10. Audit the action and store incident/ticket reference.

### 9.3 Access reviews

- Monthly: review Platform Admins, IdP Admins, Auditors, and Break-glass owners.
- Quarterly: review project group memberships with Project Owners.
- Any exceptions are recorded and time-bound.

## 10. Audit requirements for RBAC changes

- All group membership changes are logged (who changed, what changed, when, reason/ticket).
- Role mapping configuration changes are logged and require approval.
- Project folder permission template changes are logged and reviewed.
- Audit logs are retained per 03.40 and access-controlled per 03.30.

## 11. Verification checklist (mandatory)

- Create a test project code and project groups (VIEW/EDIT/OWNER).
- Assign three test users to each project role and confirm Nextcloud permissions match (view/edit/owner).
- Confirm Standard User without project group cannot see project folder or search results.
- Confirm Read-Only user cannot upload/edit but can view where permitted.
- Confirm Admin can administer, but only from Zone E allowlist and with MFA.
- Confirm any group membership change results in expected access changes and is audited.

### 11.1 Suggested verification commands

Application/terminal: AI-DATA01 and AI-FRONTEND01 (SSH).

```bash
sudo journalctl -u docker --no-pager | tail -n 50
sudo ufw status verbose
```

Application: browser tests for UI/Nextcloud access are required (document results in test log).

## 12. Client rollout variables (template)

| Variable | Value |
|---|---|
| Client name | `<ClientName>` |
| Identity mode | `AD Integrated / Local Users` |
| Baseline groups in use | `<list>` |
| Project codes | `<BANANA, NIGHTPENGUIN, DADJOKE, LASAGNA, CHUCKNORRIS, ...>` |
| Admin allowlist (Zone E) | `<CIDR/IP list>` |
| MFA required tiers | `Admins/Auditors mandatory; others per client` |
| Nextcloud external sharing | `Disabled by default; exception process` |
| Link share expiry policy | `<e.g., 7 days>` |
| Project owner delegation allowed? | `Yes/No (recommended limited Yes)` |
| Automation modules enabled | `n8n: Yes/No; Windmill: Yes/No` |
| Automation operator group | `AI-AUTOMATION-OPERATORS` |
| Access review cadence | `Monthly admins/auditors; quarterly projects` |
| Ticketing reference required for changes | `Yes` |
| Audit retention for RBAC changes | `T2/T3 per 03.40` |
| Search ACL inheritance | `Mandatory (deny if unknown)` |
| Mind-map visibility rules | `Hide nodes/edges user cannot access` |
| Break-glass owners | `<two custodians>` |
| Break-glass test frequency | `Quarterly` |
| Role mapping owner | `<name/role>` |
| Project membership approval owner | `<name/role>` |
