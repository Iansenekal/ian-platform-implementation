# AI Platform Deployment Documentation

## 04.30 MFA Policy Standard

LAN-only • POPIA-friendly • Two-VM on Proxmox • Ubuntu 24.04
MFA methods, enforcement tiers, enrollment, resets, recovery codes, and verification runbook.

## Document Control

| Field | Value |
|---|---|
| Document ID | `docs/04-Identity-Access-MFA/04.30-MFA-Policy-Standard` |
| Filename (target) | `docs/04-Identity-Access-MFA/04.30-MFA-Policy-Standard.md` (Word-authored equivalent) |
| Version | `v1.0` |
| Date | `2026-02-09` |
| Owner | Choice IT / Client Delivery Team |
| Status | Mandatory standard; MFA baseline for platform |
| Install Order Position | After 04.20 Auth Modes; before 04.40 RBAC; enforced during 11.60 IdP deployment |
| Applies to | Identity Provider, Gateway, UI, Nextcloud, Search/Graph, optional n8n/Windmill, admin consoles |
| Primary requirement | MFA mandatory for privileged roles; standardized enrollment and recovery; audited actions |
| Related docs | 03.30 Audit Logging; 03.40 Retention Policy; 04.70 BreakGlass; 11.60 MFA methods; 04.60 SSO Matrix |
| Security note | No shared accounts; no SMS-based MFA by default; recovery codes treated as secrets |
| Change control | Changes to MFA policy require approval and must be audited |

## Contents

- 1. Purpose and outcomes
- 2. MFA principles (must-follow rules)
- 3. Approved MFA methods (baseline and preferred)
- 4. Enforcement tiers (who must use MFA)
- 5. Enrollment workflow (new user and existing user)
- 6. Recovery codes and backup methods (storage and handling)
- 7. MFA resets (helpdesk/admin process)
- 8. Lost device and account recovery (standard runbook)
- 9. Break-glass access interaction (emergency only)
- 10. MFA audit events (what must be logged)
- 11. Rate limiting and lockout alignment
- 12. Verification checklist (mandatory)
- 13. Client rollout variables (template)

## 1. Purpose and outcomes

Multi-Factor Authentication (MFA) protects the platform against credential theft and is mandatory for privileged roles. This document standardizes how MFA is enforced, which methods are allowed, how enrollment happens, and how resets/recovery are handled in a POPIA-friendly, auditable way.

Outcomes:

- Consistent MFA enforcement across all modules (via the Identity Provider).
- Clear method choices (TOTP and WebAuthn/FIDO2), with secure defaults.
- A controlled and audited reset and recovery process.
- A verification checklist to prove MFA is effective and not bypassed.

## 2. MFA principles (must-follow rules)

- M1: MFA is mandatory for Platform Admins, IdP Admins, and Security Auditors (no exceptions).
- M2: Prefer phishing-resistant methods (WebAuthn/FIDO2) for admins where supported.
- M3: Do not use SMS MFA as a default method (SIM swap risk).
- M4: MFA enrollment, reset, and recovery are privileged actions and must be audited.
- M5: Recovery codes are secrets: treat them like passwords; store offline or in an approved secret vault.
- M6: No shared accounts. Named accounts only for privileged roles.
- M7: Admin consoles are restricted by allowlist (Zone E) plus MFA; both are required.

## 3. Approved MFA methods (baseline and preferred)

### 3.1 Baseline method - TOTP

- TOTP using authenticator apps (Google Authenticator, Microsoft Authenticator, Authy, etc.).
- Works offline and aligns with LAN-only constraints.
- Users must enroll at least one TOTP device/app.

### 3.2 Preferred admin method - WebAuthn / FIDO2

- Hardware keys (e.g., YubiKey) or platform passkeys where supported.
- Phishing-resistant and strongly recommended for Platform Admin and IdP Admin roles.
- Can be used in addition to TOTP as a backup factor.

### 3.3 Backup methods

- Recovery codes (mandatory for Admin and Auditor roles).
- Secondary authenticator device (recommended).

### 3.4 Not approved by default

- SMS/voice OTP (high risk, unless a client explicitly requires it and accepts the risk).
- Email OTP (depends on email system security and is often weaker).

## 4. Enforcement tiers (who must use MFA)

| Tier | Who | MFA required? | Allowed methods | Enrollment deadline | Notes |
|---|---|---|---|---|---|
| Tier 0 | Platform Admin / IdP Admin | Mandatory | TOTP + WebAuthn preferred | Before first privileged use | No exceptions; named accounts |
| Tier 1 | Security Auditors | Mandatory | TOTP (WebAuthn optional) | Before first audit access | Auditors access sensitive evidence |
| Tier 2 | Automation Operators (if enabled) | Recommended (client choice) | TOTP | Within 7 days | Can trigger privileged workflows |
| Tier 3 | Project Owners | Recommended | TOTP | Within 7 days | May manage project access |
| Tier 4 | Standard Users | Optional by default (recommended for high-risk clients) | TOTP | Within 14 days if enabled | Client policy decision |
| Tier 5 | Read-Only Users | Optional | TOTP | Within 14 days if enabled | Often used for auditors/guests |

## 5. Enrollment workflow (new user and existing user)

### 5.1 New user enrollment (standard)

1. User account is created (AD user exists in AD mode, or local user created in local mode).
2. User is assigned to baseline group(s) and any project groups as required (04.40).
3. On first login, user is forced (if required by tier) to enroll MFA before continuing.
4. User scans QR code for TOTP and confirms first OTP code.
5. User generates recovery codes (mandatory for Tier 0/1) and stores them safely.
6. Admin verifies enrollment completion for privileged roles.

Mandatory: enrollment must be audited (who enrolled, method, date/time).

### 5.2 Existing user enrollment (rollout)

7. Announce enrollment window and user instructions (client communication).
8. Enable MFA requirement per tier gradually: Admins first, then auditors, then project owners, then standard users (if required).
9. Monitor helpdesk load; provide assisted enrollment sessions where necessary.
10. At end of window, enforce MFA for required tiers (block login if not enrolled).

## 6. Recovery codes and backup methods (storage and handling)

### 6.1 Recovery codes standard

- Tier 0/1 users must generate recovery codes during enrollment.
- Recovery codes must be stored offline (printed and sealed) or in an approved secret vault.
- Do not store recovery codes in plain text documents or email.
- Rotation: regenerate codes after any suspected compromise or device loss.

### 6.2 Recommended storage approaches

- Offline sealed envelope for critical admin accounts (stored in a controlled location).
- Encrypted password manager/vault accessible only to the user (and optionally break-glass custodians per policy).

## 7. MFA resets (helpdesk/admin process)

MFA reset is a privileged action because it temporarily reduces account security. It must be controlled and audited.

### 7.1 Reset requirements

- Identity verification is required (in-person, known channel, or documented process).
- A ticket/reference number is required for any reset.
- Two-person approval is recommended for Tier 0 accounts (Platform Admin).
- All resets must be audited: who requested, who approved, who performed, and why.

### 7.2 Reset steps (standard)

11. User opens a helpdesk ticket stating device loss or MFA failure.
12. Helpdesk verifies identity and escalates to Platform Admin (Zone E) if required.
13. Admin resets MFA factors in IdP admin console.
14. Admin forces re-enrollment on next login.
15. User completes re-enrollment and generates new recovery codes.
16. Admin confirms login and MFA works; close ticket with notes.

## 8. Lost device and account recovery (standard runbook)

### 8.1 If user still has recovery codes

17. User logs in and uses a recovery code to complete MFA.
18. User enrolls a new authenticator device.
19. User regenerates recovery codes and stores them safely.
20. Admin reviews audit logs to ensure no suspicious activity occurred.

### 8.2 If user has no recovery codes

21. User opens helpdesk ticket and completes identity verification.
22. Admin performs MFA reset (Section 7).
23. User enrolls new MFA and generates recovery codes.
24. Admin reviews recent login/audit logs for suspicious activity; if suspicious, initiate incident response (05.30).

## 9. Break-glass access interaction (emergency only)

- Break-glass accounts exist only for emergency recovery (IdP outage, lockout of all admins).
- Break-glass usage is rare, time-bound, and requires post-incident review.
- Break-glass owners and procedure are defined in 04.70.
- Using break-glass must generate an incident record and a full audit export for the time window.

## 10. MFA audit events (what must be logged)

- MFA enrollment events (method, timestamp, user).
- MFA challenge events and outcomes (success/failure).
- MFA reset events (requester, approver, executor).
- Recovery code generation/regeneration events.
- Changes to MFA policy configuration (privileged change).

## 11. Rate limiting and lockout alignment

- Login rate limits should be applied at the IdP and/or reverse proxy to reduce brute force attempts.
- Account lockout should align with client security policy; lockout events are audited.
- Admin portals must be restricted by allowlist (Zone E) in addition to MFA to reduce attack surface.

## 12. Verification checklist (mandatory)

### 12.1 User flow verification (browser)

- Admin user: cannot complete login without MFA; WebAuthn works if enabled; recovery codes generated.
- Auditor user: MFA enforced; can access audit dashboards read-only.
- Standard user (if MFA enabled): forced enrollment on first login; can use TOTP after enrollment.

### 12.2 Reset verification (controlled test)

- Perform a test MFA reset on a non-production test account.
- Confirm: user is forced to re-enroll; old recovery codes no longer work after regeneration.
- Confirm: reset event is logged in audit logs.

### 12.3 Boundary verification (admin allowlist)

Application/terminal: Windows PowerShell from a non-allowlisted workstation.

```powershell
Test-NetConnection 10.10.5.186 -Port 443
```

Expected: User UI is reachable, but admin routes are blocked by allowlist policy (implementation in 20.* and UFW model).

## 13. Client rollout variables (template)

| Variable | Value |
|---|---|
| Client name | `<ClientName>` |
| Identity mode | `AD Integrated / Local Users` |
| MFA required tiers | `Tier 0/1 mandatory; others per client` |
| Admin MFA methods | `TOTP + WebAuthn preferred` |
| User MFA methods | `TOTP` |
| Recovery codes policy | `Tier 0/1 mandatory; others optional` |
| Enrollment window (rollout) | `<dates>` |
| Helpdesk reset policy | `ticket required; identity verification; audit` |
| Two-person approval for Tier 0 resets | `Yes/No (recommended Yes)` |
| Lockout threshold | `<e.g., 5 attempts>` |
| Lockout duration | `<e.g., 15 minutes>` |
| Rate limiting policy | `<proxy and IdP settings>` |
| Break-glass owners | `<two-person custody>` |
| Recovery code storage approach | `Offline sealed / vault` |
| Audit retention for MFA events | `T2/T3 per 03.40` |
| Admin allowlist (Zone E) | `<CIDR/IP list>` |
| WebAuthn allowed? | `Yes/No` |
| Device policy for admins | `Require at least 2 factors enrolled` |
| Re-enrollment on device loss | `Mandatory` |
| MFA policy review cadence | `Quarterly` |
