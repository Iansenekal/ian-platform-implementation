# AI Platform Deployment Documentation

## 03.40 Retention Policy

LAN-only • POPIA-friendly • Two-VM on Proxmox • Ubuntu 24.04  
Data minimization, retention tiers, purge rules, legal hold, and verification runbook

## Document Control

| Field | Value |
|---|---|
| Document ID | `docs/03-Security-POPIA/03.40-Retention-Policy` |
| Filename (target) | `docs/03-Security-POPIA/03.40-Retention-Policy.md` |
| Version | `v1.0` |
| Date | `2026-02-09` |
| Owner | Choice IT / Client Delivery Team |
| Status | Mandatory policy; defines retention and deletion for logs, indexes, documents, and backups |
| Install Order Position | After 03.30 Audit Logging; before backup/DR and monitoring docs are finalized |
| Applies to | Audit logs, operational logs, Nextcloud content, search indices/embeddings, automation logs, backups |
| Primary requirement | Collect minimum necessary data and enforce deletion/archival on schedule; document exceptions |
| Related docs | 03.00 Threat Model; 03.30 Audit Logging; 06.* Backup/DR; 50.* Monitoring/Logging; Nextcloud 21.60 |
| Governance note | Client legal/compliance may require adjustments. This doc provides secure defaults; client signs off on intervals |
| Change control | Retention changes are privileged actions and must be logged; legal holds override automated deletion |

## Contents

- 1. Purpose and guiding principles
- 2. Retention scope and data categories
- 3. Retention tiers (default durations)
- 4. Deletion vs archival rules (what happens at end of life)
- 5. Legal hold / investigation hold process
- 6. Component-specific retention controls
  - 6.1 Identity Provider logs
  - 6.2 Gateway API logs
  - 6.3 Nextcloud content + activity logs
  - 6.4 Search indices + embeddings/metadata
  - 6.5 Optional automation logs (n8n/Windmill)
  - 6.6 OS/system logs
- 7. Backups retention model (how retention interacts with backups)
- 8. Step-by-step implementation procedure (standard)
- 9. Verification checklist (mandatory)
- 10. Exceptions register and approval workflow
- 11. Client rollout variables (template)

## 1. Purpose and guiding principles

Retention policy is the practical enforcement of data minimization: keep only what is needed for operations, security, and compliance, for no longer than necessary. In a POPIA-friendly platform, retention must be explicit, applied consistently, and verified.

Guiding principles:

- R1: Collect minimum necessary data. Avoid storing unnecessary PII or sensitive content in logs.
- R2: Define retention per category (logs, indexes, content, backups) with clear owners and review cadence.
- R3: Enforce deletion/archival automatically where possible; do not rely on manual cleanup.
- R4: Legal hold overrides deletion. Holds are documented, time-bound, and reviewed.
- R5: Retention actions are privileged and audited (who changed what, when).
- R6: Backups do not become an unbounded retention loophole; backup retention is aligned to primary data retention and policy.

## 2. Retention scope and data categories

This platform produces multiple data categories. Each category has a different retention need.

| Category | Examples | Sensitivity | Primary location | Retention owner |
|---|---|---|---|---|
| Audit logs | IdP auth events, RBAC decisions, file shares | High | OpenSearch indices + local logs | Security Owner |
| Operational logs | proxy errors, app logs, systemd logs | Medium | `/opt/<stack>/logs`, journal | Ops Owner |
| Nextcloud content | documents, project files, attachments | Varies (often high) | Nextcloud storage | Content Owner / Project Owner |
| Search index + metadata | index fields, embeddings, connector state | High (inference risk) | OpenSearch indices | Platform Owner + Security Owner |
| Automation logs | workflow runs, triggers, outputs | Medium/High | automation db/logs | Automation Owner |
| Backups | encrypted archives | High | backup storage | Ops Owner + Security Owner |

## 3. Retention tiers (default durations)

These are secure defaults suitable for many clients. Adjust only with client sign-off. If the client has legal requirements, record them in Section 10 Exceptions Register.

| Tier | Purpose | Examples | Default duration | Storage | End-of-life action |
|---|---|---|---|---|---|
| T1: Short | Operational troubleshooting | proxy/app debug logs | 14 days | Local `/opt/<stack>/logs` | Delete |
| T2: Standard audit | Security investigations and accountability | auth events, RBAC, file shares | 180 days | OpenSearch audit indices | Rollover + delete |
| T3: Extended audit (optional) | Regulatory/compliance extended window | privileged admin actions | 365 days | OpenSearch + backups | Rollover + delete |
| T4: Content retention | Business content lifecycle | project documents | Client-defined (e.g., 3–7 years) | Nextcloud storage | Archive or delete |
| T5: Backup retention | Recovery from incidents/ransomware | daily/weekly backups | 30–90 days (default 60) | Encrypted backup store | Expire old backups |
| T6: Legal hold | Investigation or legal requirement | specific user/project/time range | Time-bound per case | Locked storage/export | Preserve; review monthly |

## 4. Deletion vs archival rules (what happens at end of life)

### 4.1 Deletion rules

- Logs: delete at end of retention window after rollover (OpenSearch index lifecycle).
- Debug logs: rotate daily and delete after 14 days (default).
- Temporary files: purge periodically (e.g., ingestion temp files).

### 4.2 Archival rules

- Business content may be archived rather than deleted (client decision).
- Archives must preserve permissions and be encrypted at rest.
- Archive access is restricted and audited.

### 4.3 Important: backups and retention alignment

Backups should not keep data longer than allowed by the client retention policy unless a legal hold is active. If the client requires long content retention, backups may keep encrypted archives, but this must be explicit and approved.

## 5. Legal hold / investigation hold process

A legal hold temporarily prevents deletion of specific data while an investigation or legal request is active.

### 5.1 When to trigger a hold

- Security incident investigation (possible breach).
- HR/legal investigation requiring preservation of evidence.
- POPIA data subject dispute where evidence is required.
- Litigation or formal legal request.

### 5.2 Hold workflow (standard)

1. Request: Security Owner or Client Representative requests hold with scope (user/project/time range/data categories).
2. Approval: Two-person approval recommended (Security Owner + Client Rep).
3. Implementation: Apply hold by exporting relevant logs/data to a secured, access-controlled location and/or pausing deletion for specific indices.
4. Access: Restrict hold data access to authorized investigators only; log every access.
5. Review: Review monthly and close when no longer required.
6. Release: When hold is released, normal retention resumes; data outside retention is purged unless another hold applies.

## 6. Component-specific retention controls

### 6.1 Identity Provider logs

- Retain authentication and admin events per Tier T2/T3.
- Minimize stored attributes: log user IDs and group changes, not full PII fields.
- Export key events to OpenSearch for unified investigations (LAN-only).

### 6.2 Gateway API logs

- Access logs retained short (T1) for troubleshooting; audit/RBAC logs retained standard (T2/T3).
- Do not log tokens, secrets, or request bodies containing sensitive data unless specifically approved and redacted.
- Ensure correlation IDs exist for traceability without storing excessive payload data.

### 6.3 Nextcloud content + activity logs

- Content retention is client-defined (T4). Use project lifecycles and archive rules.
- Nextcloud activity logs retained standard audit (T2/T3) depending on client risk profile.
- External share links should have expiry by policy; link events are logged and retained (T2/T3).

### 6.4 Search indices + embeddings/metadata

- Treat embeddings and metadata as sensitive; they inherit ACL rules from source documents.
- Retain indices per T2/T3 for audit and operations, but remove orphaned index entries when source content is deleted.
- When content is deleted/archived, the index must be re-synchronized (delete or move entries) to prevent search visibility drift.
- Connector state and job logs retained short (T1) unless needed for audit (T2).

### 6.5 Optional automation logs (n8n/Windmill)

- Retain workflow run history per client preference; default T1 (14–30 days) for detailed run logs and T2 for audit summary.
- Do not store full payloads in run logs when they contain sensitive data; log references/IDs instead.
- Credential changes and admin actions retained at least T2.

### 6.6 OS/system logs

- Journal logs retained per system defaults but should align to T1 for verbose logs and T2 for auth/sudo events if exported.
- SSH/sudo events are security-relevant; treat them as audit events when centralized.

## 7. Backups retention model (how retention interacts with backups)

Backups support recovery, but they must be aligned to retention. This model applies by default:

- Daily backups retained 14 days; weekly backups retained 8 weeks; monthly backups retained 12 months (adjustable).
- Backups are encrypted. Access to backup storage is privileged and audited.
- Restore tests are performed regularly (06.20) to ensure backups are usable.
- When a legal hold is active, relevant backups may be preserved longer by exception with explicit approval.

## 8. Step-by-step implementation procedure (standard)

This section defines a standard rollout sequence to implement retention across the platform. Stack-specific docs will provide exact configs, but this operational order is mandatory.

### Step 1 - Confirm what data categories exist for the client

Application: Client workshop + deployment planner.

7. List all data categories that will exist (Nextcloud content, search index, optional cloud mirror, automation logs).
8. Identify which categories contain personal information or sensitive content.
9. Assign a retention owner for each category (Security, Ops, Content).

### Step 2 - Confirm default tier durations and get client sign-off

10. Present Tier defaults (Section 3).
11. Adjust only if client requires (legal/compliance/business).
12. Record final durations in the Client Rollout Variables section and exceptions register if needed.

### Step 3 - Implement log rotation on hosts

Application/terminal: SSH to each VM.

13. Ensure application logs are written to `/opt/<stack>/logs` and rotated.
14. Ensure verbose debug logs are short-lived (T1).

Verification commands (generic):

```bash
sudo ls -la /opt/*/logs 2>/dev/null || true
sudo journalctl --disk-usage
```

### Step 4 - Implement OpenSearch index lifecycle for audit indices

Apply rollover + delete policies for audit indices (T2/T3). OpenSearch management is restricted to admins/auditors only.

Verification (conceptual): indices roll over; older indices are deleted per policy.

### Step 5 - Implement Nextcloud retention/cleanup and archive workflow

15. Define project lifecycle and archive strategy (T4).
16. Enforce external share expiry policy and remove expired shares.
17. Ensure deleted content is reflected in search indices (re-sync).

### Step 6 - Implement automation logs retention (if enabled)

18. Set workflow run history retention (detailed vs summary).
19. Ensure credential changes and admin actions are retained at least T2.

### Step 7 - Align backup retention and test restores

20. Implement backup schedule and retention (06.*).
21. Ensure backup retention does not violate client policy.
22. Perform restore tests and record results (06.20).

### Step 8 - Document and enforce the legal hold process

23. Define who can request/approve holds.
24. Define how hold data is stored and who can access it.
25. Schedule monthly hold reviews and document release procedure.

## 9. Verification checklist (mandatory)

These checks prove retention is implemented and not only documented.

### 9.1 Verify time sync (correlation)

```bash
timedatectl status
```

### 9.2 Verify log directories exist and are not world-readable

```bash
sudo find /opt -maxdepth 4 -type d -name logs -exec ls -ld {} \;
```

### 9.3 Verify audit indices retention exists (OpenSearch)

Application: Admin workstation browser to OpenSearch Dashboards (admin-only).

- Check index lifecycle/rollover policies are configured for audit indices.
- Confirm older indices are deleted per T2/T3 windows.

### 9.4 Verify Nextcloud lifecycle controls (content)

- Confirm external share links have expiry by default (policy).
- Confirm archive folder workflow exists for closed projects.
- Confirm index re-sync process removes orphaned entries after deletes.

### 9.5 Verify backup retention

- Confirm backup storage contains only backups within the retention window.
- Confirm backups are encrypted and access is restricted.
- Confirm at least one restore test has been executed and logged.

## 10. Exceptions register and approval workflow

Any deviation from default retention tiers must be recorded here. This includes longer retention, additional logging, or keeping data in backups longer.

| Exception ID | Category | Requested change | Reason | Approver | Start date | Review date |
|---|---|---|---|---|---|---|
| `<EX-##>` | `<Category>` | `<Change>` | `<Reason>` | `<Approver>` | `<YYYY-MM-DD>` | `<YYYY-MM-DD>` |
| `<EX-##>` | `<Category>` | `<Change>` | `<Reason>` | `<Approver>` | `<YYYY-MM-DD>` | `<YYYY-MM-DD>` |
| `<EX-##>` | `<Category>` | `<Change>` | `<Reason>` | `<Approver>` | `<YYYY-MM-DD>` | `<YYYY-MM-DD>` |
| `<EX-##>` | `<Category>` | `<Change>` | `<Reason>` | `<Approver>` | `<YYYY-MM-DD>` | `<YYYY-MM-DD>` |
| `<EX-##>` | `<Category>` | `<Change>` | `<Reason>` | `<Approver>` | `<YYYY-MM-DD>` | `<YYYY-MM-DD>` |

## 11. Client rollout variables (template)

| Variable | Value |
|---|---|
| Client name | `<ClientName>` |
| Audit retention (standard) | 180 days (T2) or client-defined |
| Audit retention (extended) | 365 days (T3) if required |
| Debug/ops logs retention | 14 days (T1) |
| Content retention (Nextcloud) | `<e.g., 5 years; archive policy>` |
| Search index retention | Aligned to content; remove orphaned entries on delete |
| Automation run logs retention | 14–30 days detailed; 180 days summary (default) |
| Backup retention model | Daily 14d / Weekly 8w / Monthly 12m (default) |
| Backup encryption | `<method>` |
| Backup custodians | `<names>` |
| Legal hold approvers | `<Security Owner + Client Rep>` |
| Hold storage location | `<secure path>` |
| Review cadence for retention policy | Quarterly (recommended) |
| Exception register owner | `<name>` |
