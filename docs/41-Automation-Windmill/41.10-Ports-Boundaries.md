# AI Platform Deployment Documentation
## 41.10 Automation - Windmill (Optional) Ports and Trust Boundaries

LAN-only runtime - POPIA-friendly - Two-VM on Proxmox - Ubuntu 24.04

Document Control
- Document ID: `docs/41-Automation-Windmill/41.10-Ports-Boundaries`
- Filename: `docs/41-Automation-Windmill/41.10-Ports-Boundaries.md`
- Version: `v1.0`
- Date: `2026-02-09`
- Owner: Choice IT / Network + Security
- Status: Design baseline
- Scope: ports, trust boundaries, inbound/outbound rules, and UFW intent for Windmill
- Hard requirements: LAN-only, strict allowlist, internal TLS, no public exposure
- Related docs: `02.*`, `41.00`, `04.*`, `03.*`, `06.*`
- Default placement: `AI-DATA01 (10.10.5.178)`
- Default access: Admin/Operators/Builders only, SSO + MFA for privileged roles
- Time zone: `Africa/Johannesburg`
- Lab CIDR: `10.10.5.0/24`
- Evidence requirement: UFW status output and deny tests from unauthorized hosts
- Change trigger: VM placement change, new integration, or UI exposure changes
- Note: Windmill executes code and is privileged; keep access narrow

## 1. Placement and Trust Zone Assumptions
- Windmill is deployed on `AI-DATA01` by default in the backend/data zone.
- Windmill is privileged because it runs scripts against internal systems.
- inbound access is limited to admin/operator/builder sources via explicit allowlists.
- outbound traffic is deny-by-default and explicitly allowlisted.

## 2. Inbound Ports (Windmill UI/API)
- Windmill UI/API is exposed through internal TLS reverse proxy only.
- direct app exposure on `8000` stays localhost-only behind proxy.

| Service | Port | Bind Scope | Allowed Inbound Sources | Notes |
|---|---|---|---|---|
| Windmill UI/API via reverse proxy | 443 | LAN interface only | admin/operator/builder allowlist; optional AI-FRONTEND01 | internal DNS + internal TLS |
| Windmill app direct endpoint | 8000 | localhost only | reverse proxy process only | never expose directly to LAN |

## 3. Internal Dependencies (DB/Worker Components)
- Windmill commonly uses internal Postgres and internal worker communications.
- DB should remain local/host-restricted where feasible.
- shared Postgres requires least privilege and restricted host access.

| Dependency | Port | Exposure | Notes |
|---|---|---|---|
| Windmill Postgres | 5432 | localhost preferred | dedicated DB/user; no identity DB overlap |
| Windmill worker comms | varies | Docker network only | never exposed to LAN |

## 4. Outbound Communications
- outbound defaults to deny; internal destinations are explicitly allowlisted.
- external destinations require explicit governance approval.

| Destination | Port(s) | Purpose | Restrictions |
|---|---|---|---|
| Backend Gateway | 443 | policy-enforced operations via API | internal TLS + allowlist |
| Nextcloud | 443 | file actions via Gateway or scoped account | prefer Gateway path |
| OpenSearch | 9200 | reporting/alerts | read-only default |
| Identity Provider | 443 | SSO validation/redirects | LAN only |
| Email relay | 25/587 | internal notifications | LAN only |

## 5. UFW Allowlist Intent
- inbound `443` is restricted to named admin/operator/builder source endpoints.
- allow `AI-FRONTEND01` inbound only when integration requires it.
- all other LAN hosts are denied by default.

## 6. Trust Boundary Rules
- no Docker socket or host-privileged API access from Windmill.
- script execution uses least-privilege credentials with restricted egress.
- prefer Gateway-mediated operations requiring policy checks and centralized audit.
- no direct writes to identity provider databases or privileged system stores.

## 7. Integration Boundaries
### 7.1 Backend Gateway
- preferred integration point for policy and business-logic controls.

### 7.2 Database
- dedicated DB user per script domain; restricted schema/table scope.
- shared Postgres deployments remain host/firewall restricted.

### 7.3 Nextcloud
- prefer Gateway-mediated Nextcloud actions for consistent policy/audit.
- direct access requires scoped accounts and constrained folder scope.

### 7.4 OpenSearch
- read-only default for reporting/health checks.
- write access requires explicit approval and index-level permissions.

## 8. Risk Notes and Mitigations
- data exfiltration risk: outbound allowlist and no default internet egress
- overbroad credentials: scoped accounts, rotation, and periodic access review
- UI misuse risk: strict allowlists, SSO+MFA, and role separation
- unreviewed script risk: change control and required code review

## 9. Verification Checklist
- Windmill reachable only from allowlisted sources
- app port `8000` not exposed to LAN
- reverse proxy enforces internal TLS and host policy
- outbound rules enforce approved internal destinations only
- scripts cannot reach internet unless explicitly approved and allowlisted

## 10. Client Rollout Variables
- Windmill enabled
- deployment VM
- Windmill internal DNS name
- reverse proxy choice
- inbound allowlist IPs
- allow frontend inbound
- outbound allowed destinations
- external outbound exception list
- Nextcloud integration mode
- OpenSearch access mode
- Admin/Operator/Builder role definitions
