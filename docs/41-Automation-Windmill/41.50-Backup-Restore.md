# AI Platform Deployment Documentation
## 41.50 Automation - Windmill (Optional) Backup and Restore

LAN-only runtime - POPIA-friendly - Two-VM on Proxmox - Ubuntu 24.04

Document Control
- Document ID: `docs/41-Automation-Windmill/41.50-Backup-Restore`
- Filename: `docs/41-Automation-Windmill/41.50-Backup-Restore.md`
- Version: `v1.0`
- Date: `2026-02-09`
- Owner: Choice IT / Platform Ops
- Status: Mandatory if Windmill is enabled
- Scope: backup scope, schedules, restore process, and post-restore validation
- Hard requirements: no unencrypted secrets in backups; restore test required; evidence retained
- Related docs: `06.*`, `03.20`, `41.30`, `50.*`
- Placement assumption: `AI-DATA01`
- Time zone: `Africa/Johannesburg`
- Evidence requirement: backup logs, restore test report, RBAC deny tests
- RPO/RTO alignment: client-specific in `06.*`
- Approver: Platform Owner + Security
- Note: backups must preserve scripts/jobs and state; restores must revalidate SSO/RBAC and safe logging

## 1. Required Backup Scope
- Windmill database: jobs, scripts, schedules, execution history, and access mapping metadata
- versioned script/flow exports in governance repository
- Windmill configuration templates and runtime config references (non-secret)
- reverse proxy configuration where Windmill ingress is dedicated
- governance artifacts: job catalog, approvals, secret inventory references, access review records
- encryption/secret dependency recovery path required for successful restore posture

## 2. Disallowed Backup Content (unless encrypted)
- plaintext secrets in notes/docs/tickets
- unencrypted secret files
- unsanitized job outputs containing sensitive payloads
- screenshots or dumps containing tokens/passwords

## 3. Recommended Backup Frequency and Retention
- Windmill database: daily (or higher for high run volume), retention 30-90 days
- script/flow exports: on every change plus daily snapshot, retention 180-365 days
- config templates/proxy config: on change plus weekly snapshot, retention 180 days
- audit evidence pack: weekly, retention 180-365 days

## 4. Restore Procedure
1. confirm incident scope and restoration target (service-only vs full VM)
2. validate access to secret/encryption dependencies per `41.30` and `03.20`
3. restore Windmill database from known-good backup
4. restore Windmill config and reverse proxy assets where required
5. start services and confirm health plus LAN UI reachability
6. revalidate SSO/MFA and RBAC role mapping
7. run representative jobs and verify safe logging behavior
8. capture evidence (time, backup set, validations, remediation)

## 5. Mandatory Post-Restore Verification
- Windmill starts cleanly and remains healthy
- LAN-only access and allowlists remain enforced
- SSO login and admin MFA enforcement function correctly
- RBAC deny tests pass for privileged settings and restricted jobs
- expected script/flow catalog and schedules are present
- representative least-privilege job execution succeeds
- logs/audit remain active without secret/sensitive payload leakage
- scheduled backups resume after recovery

## 6. Restore Test Schedule
- monthly: lightweight lab restore (DB restore + startup validation)
- quarterly: full restore including representative jobs + RBAC/MFA + safe-logging checks
- post-upgrade: restore validation from fresh backup set

## 7. Client Rollout Variables
- Windmill enabled
- backup tooling standard
- backup destination path
- DB backup frequency
- retention days
- secret/encryption dependency storage method
- script export repository location
- restore test cadence
- RPO/RTO targets
- evidence repository path
- restore approval roles
