# AI Platform Deployment Documentation
## 41.00 Automation - Windmill (Optional) Overview

LAN-only runtime - POPIA-friendly - Two-VM on Proxmox - Ubuntu 24.04

Document Control
- Document ID: `docs/41-Automation-Windmill/41.00-Overview`
- Filename: `docs/41-Automation-Windmill/41.00-Overview.md`
- Version: `v1.0`
- Date: `2026-02-09`
- Owner: Choice IT / Platform Engineering + Security
- Status: Design baseline
- Scope: Windmill role, use cases, governance, and operational posture
- Hard requirements: LAN-only, least privilege, RBAC, auditable executions, no cloud runtime dependency
- Related docs: `02.*`, `03.*`, `04.*`, `06.*`, `50.*`, `40.*`
- Placement: Optional module, recommended on `AI-DATA01`
- Primary role: run versioned scripts/jobs with RBAC and auditability
- Primary integrations: Backend Gateway APIs, Postgres, Nextcloud (via Gateway), OpenSearch (read-only)
- Time zone: `Africa/Johannesburg`
- Lab defaults: `AI-DATA01 10.10.5.178`, `AI-FRONTEND01 10.10.5.179`, `LAN 10.10.5.0/24`
- Evidence requirement: job catalog, access review, audit evidence, backup/restore test
- Note: Windmill executes code; treat as privileged and tightly governed

## 1. Role of Windmill in the Platform
- Windmill is the internal job runner for versioned script execution with RBAC and audit.
- It is used for scheduled tasks, data transforms, and controlled internal tooling.
- Windmill complements n8n: n8n orchestrates events/workflows while Windmill executes code-centric tasks.

## 2. Windmill vs n8n Decision Guide
| Use case | Prefer | Reason |
|---|---|---|
| Human approvals and event-driven workflow | n8n | UI-centric orchestration and connectors |
| Scheduled scripts and admin-safe tooling | Windmill | code execution with role controls and audit |
| Hybrid complex automation | n8n + Windmill | n8n orchestrates, Windmill executes scripts |
| Simple API routing | Gateway or n8n | prefer Gateway for policy + centralized audit |

## 3. Allowed and Prohibited Patterns
### 3.1 Allowed
- run versioned scripts with owner metadata and review history
- call Backend Gateway for policy-bound business operations
- use scoped DB accounts and project-scoped permissions
- run reporting/housekeeping jobs under retention and minimization controls

### 3.2 Prohibited by Default
- unreviewed scripts with broad privileges
- direct Docker socket or privileged host API access
- outbound internet access unless explicitly approved and allowlisted
- storing secrets in script source or repository artifacts

## 4. Recommended Deployment Placement
- default on `AI-DATA01` to keep execution close to internal services
- optional separate automation VM for strict isolation requirements
- Windmill UI is LAN-only and restricted to operator/admin allowlists

## 5. Trust Boundaries and Data Flows
- Windmill is privileged because it executes code.
- prefer Gateway-mediated operations over direct writes to core systems.
- use separate integration credentials with project-level scoping where feasible.

## 6. Identity, SSO, and MFA Posture
- integrate Windmill with platform IdP SSO where possible
- admin access requires MFA and strict source allowlisting
- RBAC separates Admin, Operator, Script Builder, and Viewer roles
- break-glass controls align to `04.70`

## 7. Secrets and Environment Governance
- secrets are never stored in scripts, git, or job exports
- apply `03.20` secrets standard for environment and credential injection
- each environment (DEV/LAB/PROD) uses separate credential sets
- all credentials require owners and rotation dates

## 8. Script/Job Lifecycle and Change Control
1. request with purpose, data class, and required access
2. design with Windmill/n8n decision and minimization plan
3. security approval for scope and credential usage
4. build in DEV with code review for privileged scripts
5. test functional, deny, and performance controls
6. promote versioned release to PROD with change ticket
7. operate with monitoring, credential rotation, and script retirement

## 9. POPIA Controls
- process IDs/references where possible, not full payload content
- avoid sensitive payload logging; log metadata only
- retain and purge job logs per policy alignment (`03.40`, `30.70`)

## 10. Observability and Operations
- expose health endpoints and scheduler status for monitoring
- alert on job failures, retries, and queue/scheduler issues
- enforce concurrency limits and timeouts to protect dependencies

## 11. Backup and DR Posture
- backup includes Windmill DB, versioned script exports, and non-secret config templates
- restore verification includes RBAC/SSO checks and sample job execution
- quarterly restore tests for representative scripts/flows

## 12. Verification Checklist
- LAN-only access and allowlists are enforced
- SSO + MFA works and RBAC limits access by role
- no secrets in scripts/logs/exports
- job catalog exists with owners/approvals
- monitoring, backup, and restore-test evidence exists

## 13. Client Rollout Variables
- Windmill enabled
- deployment VM
- internal Windmill DNS name
- SSO enabled
- admin MFA required
- RBAC roles and mappings
- allowed integrations list
- outbound internet policy
- job log retention days
- backup schedule and destination
- restore test frequency
- change approval roles
