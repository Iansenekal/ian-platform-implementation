# AI Platform Deployment Documentation
## 41.20 Automation - Windmill (Optional) SSO and MFA Policy

LAN-only runtime - POPIA-friendly - Two-VM on Proxmox - Ubuntu 24.04

Document Control
- Document ID: `docs/41-Automation-Windmill/41.20-SSO-MFA-Policy`
- Filename: `docs/41-Automation-Windmill/41.20-SSO-MFA-Policy.md`
- Version: `v1.0`
- Date: `2026-02-09`
- Owner: Choice IT / Identity + Security
- Status: Mandatory if Windmill is enabled
- Scope: SSO posture, MFA requirements, roles, session policy, and recovery for Windmill
- Hard requirements: LAN-only, MFA for admins, least privilege, auditable privileged access
- Related docs: `04.*`, `11.*`, `03.30`, `41.10`
- Primary identity mode: IdP SSO (`OIDC`/`SAML` as supported)
- Time zone: `Africa/Johannesburg`
- Evidence requirement: SSO login evidence, MFA enforcement evidence, RBAC deny tests
- Change trigger: IdP changes, group mapping changes, or Windmill upgrades
- Approver: Security + Platform Owner
- Note: Windmill executes code; privileged access must be hardened and audited

## 1. Policy Goals
- restrict Windmill access to the smallest approved staff set
- enforce MFA for privileged roles with least-privilege day-to-day operation
- support AD-backed and no-directory organizations without weakening controls
- maintain auditable access and script/job configuration change trails

## 2. Identity Modes
### 2.1 Preferred: IdP SSO
- Windmill authenticates via platform IdP using supported federation mode
- group claims map to Windmill roles and optional scoped workspaces/projects
- MFA policy is enforced centrally at the IdP

### 2.2 Supported (no-directory): IdP-local users
- organizations without AD maintain users in IdP local directory
- privileged roles still require MFA and policy-based role membership
- Windmill is not the primary user directory

### 2.3 Fallback: local Windmill users (break-glass only)
- local Windmill accounts are disabled by default and reserved for incidents
- break-glass credentials are offline and dual-controlled
- post-use rotation and access review are mandatory

## 3. MFA Requirements by Role
| Role | MFA Required | Methods | Notes |
|---|---|---|---|
| Windmill Admin | Yes (mandatory) | WebAuthn preferred, TOTP, recovery codes | restricted membership + source allowlist |
| Windmill Operator | Recommended | WebAuthn or TOTP | execution/queue operations within scope |
| Windmill Script Builder | Recommended | WebAuthn or TOTP | script authoring in assigned scopes |
| Windmill Viewer | Optional | TOTP optional | read-only job visibility |

## 4. RBAC Mapping for Windmill Roles
- baseline groups align with platform naming and claims conventions
- baseline groups: `AI-WM-ADMINS`, `AI-WM-OPERATORS`, `AI-WM-BUILDERS`, `AI-WM-VIEWERS`
- optional project groups: `AI-WM-PROJ-<CODE>-BUILDERS/VIEWERS`
- separation of duties required for privileged scripts and high-risk operations

## 5. Session and Login Security
- short session lifetime for admins and stricter idle timeout
- re-authentication required for sensitive actions
- lockout policy is enforced at IdP for repeated failures
- access limited to LAN allowlisted sources only

## 6. Account Lifecycle
1. joiner: create identity and assign least-privilege Windmill groups with MFA enrollment
2. mover: update group memberships and review scope/token ownership
3. leaver: disable identity immediately and rotate shared credentials if applicable
4. quarterly access review for dormant or excessive privileged access

## 7. Break-Glass and Recovery Controls
- maintain one controlled break-glass admin path
- store credentials offline with documented dual-control retrieval
- require incident ticket, approval, and post-use credential rotation
- test recovery codes quarterly

## 8. Audit Requirements
- authentication success/failure and MFA events
- role/group membership changes affecting Windmill access
- script/job create/edit/delete and permission changes
- job execution metadata (actor/service identity, start/end, outcome)
- credential creation/rotation events where applicable
- break-glass usage and post-incident rotation evidence

## 9. Verification Checklist
- SSO login works and group claims map correctly to Windmill roles
- MFA is enforced for admins (and policy-selected operators/builders)
- RBAC deny tests block non-admin access to privileged settings/jobs
- session timeout and lockout controls behave as defined
- audit logs capture access and script/job change events
- break-glass process is documented and tested

## 10. Client Rollout Variables
- Windmill enabled
- identity mode (`sso` / `idp_local_users` / `break_glass_local`)
- MFA requirements by role
- allowed MFA methods
- Windmill role group names
- project-scoped group enablement
- session max lifetime by role
- idle timeout minutes
- lockout policy
- access allowlist IPs
- break-glass account and storage method
- audit retention days
