# 83.20 Security Smoke Tests (UFW Default Deny, Non-Allowed Port Scans, SSH Restrictions)

Document ID: `docs/83-PrePhase-Integration/83.20-Security-Smoke-Tests`  
Version: `v1.0`  
Date: `2026-02-10`  
Owner: `Security Architect / Platform Ops`  
Status: `Mandatory pre-phase verification`

## Purpose
Minimal mandatory security smoke pack to prove LAN-only hardening is active before bootstrap.

## Preconditions
- One non-allowlisted LAN host exists for negative tests.
- At least one allowlisted admin workstation IP exists.
- SSH access to AI-DATA01, AI-FRONTEND01, and LLM pointer host.

## Repo Automation
- Inputs: `infrastructure/prephase/tests/83.20-security-smoke-inputs.env.example`
- Runner: `infrastructure/prephase/tests/83.20-security-smoke-tests.sh`
- Evidence checklist: `infrastructure/prephase/tests/83.20-evidence-checklist.md`

## Inputs (example rollout)
- LAN CIDR: `10.10.5.0/24`
- AI-DATA01: `10.10.5.178`
- AI-FRONTEND01: `10.10.5.179`
- LLM pointer: `10.10.5.177`
- DNS: `10.10.5.160`
- Allowlisted admin SSH IPs: fill
- Non-allowed test host IP: fill

## Mandatory Checks
1. UFW active + default deny incoming on all servers.
2. Listener proof (`ss -tulpen`) matches documented service exposure.
3. Non-allowlisted host scans show only expected public-to-LAN service ports.
4. SSH from allowlisted admin passes.
5. SSH from non-allowlisted host fails.
6. LLM `11434` allowlist enforcement proven:
   - AI-DATA01 pass
   - non-allowlisted host fail
   - AI-FRONTEND01 behavior matches policy.
7. AI-DATA01 datastore ports (`5432`, `9200`) are not reachable from LAN clients.

## Execution
1. Fill env file.
2. Run:
   - `bash infrastructure/prephase/tests/83.20-security-smoke-tests.sh --env-file infrastructure/prephase/tests/83.20-security-smoke-inputs.env`
3. Store outputs in evidence pack per `06.40`.

## Completion
All PASS conditions met with evidence for both successful allowlisted access and expected blocked attempts.
