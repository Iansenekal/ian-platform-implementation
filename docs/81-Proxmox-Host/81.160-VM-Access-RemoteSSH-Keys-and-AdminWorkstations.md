# 81.160 VM Access (Remote SSH Keys, Admin Workstations, VS Code Remote-SSH)

Document ID: `docs/81-Proxmox-Host/81.160-VM-Access-RemoteSSH-Keys-and-AdminWorkstations`  
Version: `v1.0`  
Date: `2026-02-10`  
Owner: `Platform Ops / DevOps Lead`

## Purpose
Standardize secure admin access to platform VMs using per-user SSH keys, strict source allowlists, and consistent VS Code Remote-SSH prerequisites.

## Scope
Administrative SSH access only.

## Prerequisites
- `81.110` and `81.120` VM installs complete.
- `81.150` hardening applied.

## Core Principles
- Unique user accounts per admin (no shared generic accounts).
- No root SSH login.
- Key-based SSH authentication.
- UFW SSH source allowlists restricted to approved admin workstation IPs.
- Private keys protected with passphrases and handled as secrets.

## Repo Implementation
- Access artifacts:
- `infrastructure/vm-provisioning/access/README.md`
- `infrastructure/vm-provisioning/access/admin-workstation-inventory.csv`
- `infrastructure/vm-provisioning/access/admin-users-keys.example.csv`
- `infrastructure/vm-provisioning/access/vscode-ssh-config.example`
- Provision script:
- `infrastructure/vm-provisioning/access/provision-admin-access.sh`
- Verification script:
- `infrastructure/vm-provisioning/access/verify-admin-access.sh`
- Evidence checklist:
- `infrastructure/vm-provisioning/access/81.160-evidence-checklist.md`

## Execution Pattern (Per VM)
1. Fill workstation inventory and admin key CSV.
2. Fill access env file:
   - `infrastructure/vm-provisioning/access/81.160-access-inputs.env`
3. Run provisioning as root:
   - `sudo bash infrastructure/vm-provisioning/access/provision-admin-access.sh --env-file infrastructure/vm-provisioning/access/81.160-access-inputs.env --keys-file infrastructure/vm-provisioning/access/admin-users-keys.csv`
4. Keep current SSH session open and test each admin login in a second terminal.
5. Run verifier:
   - `bash infrastructure/vm-provisioning/access/verify-admin-access.sh --env-file infrastructure/vm-provisioning/access/81.160-access-inputs.env --keys-file infrastructure/vm-provisioning/access/admin-users-keys.csv`

## VS Code Remote-SSH Baseline
- Workstation has VS Code + Remote-SSH extension + OpenSSH client.
- VM SSH key auth works.
- Recommended host alias config at:
- Windows: `%USERPROFILE%\\.ssh\\config`
- macOS/Linux: `~/.ssh/config`
- Example template:
- `infrastructure/vm-provisioning/access/vscode-ssh-config.example`

## Mandatory Verification
- Each admin can SSH with their own key.
- Root login disabled and password SSH disabled (unless controlled exception).
- UFW allows SSH only from approved admin IPs.
- VS Code Remote-SSH can connect using aliases or direct IP.
- Admin inventory table completed with fingerprints.

## Evidence
- Admin inventory table with IPs and key fingerprints.
- `ufw status numbered`
- `ssh -vv <user>@<vm-ip>` (first lines, sanitized)
- Optional VS Code Remote-SSH success screenshot.
