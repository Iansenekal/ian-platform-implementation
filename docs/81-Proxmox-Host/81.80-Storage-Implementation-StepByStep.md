# 81.80 Proxmox Host Storage Implementation (Step-by-Step)

Document ID: `docs/81-Proxmox-Host/81.80-Storage-Implementation-StepByStep`  
Version: `v1.0`  
Date: `2026-02-10`  
Owner: `Infrastructure / Platform Ops`

## Purpose
Implement the approved Proxmox storage plan by creating ISO storage, VM disk datastore, and backup datastore aligned to backup/DR controls.

## Scope
Proxmox storage objects and host configuration only.

## Prerequisites
- `81.70` storage decision complete.
- Proxmox host installed and reachable.

## 1) Inputs
| Item | Value |
|---|---|
| Storage mode | `lvm_thin` or `zfs` |
| OS disk(s) | `<fill>` |
| VM data disk(s) | `<fill>` |
| Backup target type | `<fill>` |
| Backup retention policy | `<fill>` |
| ISO storage location | `<fill>` |

## 2) Disk Discovery (Mandatory)
Run on Proxmox host:

```bash
lsblk -o NAME,SIZE,TYPE,FSTYPE,MOUNTPOINT,MODEL,SERIAL
fdisk -l | head -n 80
pvs; vgs; lvs || true
zpool status || true
df -hT
```

## 3) ISO Storage
UI path: `Datacenter -> Storage`
- Confirm existing ISO-capable storage or add `Directory` storage (`iso-store`).
- Ensure content includes `ISO image`.
- Upload Ubuntu 24.04 ISO and verify it is listed.

## 4) Primary VM Datastore
For `lvm_thin`:
- Add `LVM-Thin` storage (example ID: `vm-disks`), content `Disk image` + `Container`.
- Verify with `lvs`, `vgs`, `pvesm status`.

For `zfs`:
- Add `ZFS` storage (example ID: `zfs-vm`), content `Disk image` (+ optional `Container`).
- Verify with `zpool status`, `zfs list`, `pvesm status`.

## 5) Backup Datastore (VZDump)
- Add `Directory` storage (example ID: `backup-store`, path `/mnt/backup`).
- Content must include `VZDump backup file`.
- Prefer off-primary datastore location.

Verification:

```bash
pvesm status
df -hT | grep -E "/mnt/backup|backup" || true
```

## 6) Naming Conventions
- ISO storage: `iso-store` (or existing `local` if standardized)
- VM storage: `vm-disks` (LVM-thin) or `zfs-vm` (ZFS)
- Backup storage: `backup-store`

## 7) Mandatory Gate
- Disk inventory recorded.
- ISO store exists and ISO uploaded.
- Primary VM datastore exists and active.
- Backup datastore exists and active.
- Naming conventions match plan.

## 8) Evidence
- Outputs: `lsblk`, `df -hT`, `pvesm status`.
- Datacenter Storage screenshots with content types.
- LVM or ZFS health outputs depending on selected mode.

## 9) Repo Helpers
- Inputs: `infrastructure/proxmox/storage/81.80-storage-inputs.env.example`
- Verification: `infrastructure/proxmox/storage/81.80-storage-verify.sh`
- Evidence checklist: `infrastructure/proxmox/storage/81.80-evidence-checklist.md`
