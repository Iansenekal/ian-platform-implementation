# 81.30 Proxmox Host Post-Install Hardening

Document ID: `docs/81-Proxmox-Host/81.30-Proxmox-PostInstall-Hardening`  
Version: `v1.0`  
Date: `2026-02-10`  
Owner: `Infrastructure / Platform Ops`

## Purpose
Harden the Proxmox host post-install: updates, repository policy, admin accounts, SSH posture, time sync, and host config backup.

## Scope
Proxmox host only (no VM creation). LAN-only management enforced.

## Hard Requirements
- LAN-only management.
- Least privilege.
- Deny-by-default.
- No application workloads on host.
- Verify after every section.

## 1) Update policy and repositories

### Capture baseline state
```bash
pveversion -v
cat /etc/os-release
apt-cache policy | head -n 30
grep -R "^deb" -n /etc/apt/sources.list /etc/apt/sources.list.d/*.list 2>/dev/null || true
```

### Repository policy
- Production: official enterprise repository.
- Lab: no-subscription/community repository if required.
- Remove untrusted third-party repositories.

### Apply updates
```bash
apt update
apt -y full-upgrade
reboot
```

Verification:
```bash
uptime
systemctl is-system-running || true
journalctl -p err -b --no-pager | tail -n 50
```

## 2) Admin accounts and least privilege
- Create named admin users.
- Keep root as break-glass.
- Assign minimum required roles.

Recommended role baseline:
- `PVEAdmin`: minimal break-glass users.
- `PVEVMAdmin`: daily VM ops.
- `PVEAuditor`: read-only compliance visibility.

## 3) SSH policy (LAN-only, keys-first)
- Allow SSH only from allowlisted admin workstations.
- Use key-based auth for named admins.
- Disable/restrict root SSH login per break-glass design.

Verification:
```bash
systemctl status ssh --no-pager
ss -tulpen | grep -E ":22\b" || true
grep -E "^(PasswordAuthentication|PermitRootLogin|PubkeyAuthentication)" /etc/ssh/sshd_config || true
```

## 4) Time sync
- Use one service (`systemd-timesyncd` or `chrony`).
- Prefer LAN NTP source where available.

Verification:
```bash
timedatectl
timedatectl show-timesync --all | head -n 40 || true
```

## 5) Host firewall posture (management allowlist)
- Allow 8006 and 22 only from admin workstation IPs.
- Deny all other inbound by default.

Verification:
```bash
ss -tulpen
ip a
```

## 6) Backup Proxmox host configuration
Back up at least:
- `/etc/pve/`
- network config files
- `/etc/hosts`, `/etc/resolv.conf`
- `/etc/ssh/` (policy permitting)
- `/root/.ssh` (policy permitting)
- `/etc/apt/` source lists

Retention recommendation:
- daily x7, weekly x4, monthly x6 (adjust by policy).

Verification:
```bash
tar -tf <archive> | head
sha256sum <archive> > <archive>.sha256
```

## 7) Mandatory hardening gate
All must pass:
- Host updated and rebooted as needed.
- Trusted repository policy documented.
- Named admins in place; root break-glass only.
- SSH policy confirmed.
- Time sync healthy.
- Only expected listeners present.
- Host config backup created and checksum recorded.

## Client Rollout Variables
| Variable | Client value |
|---|---|
| Admin workstation allowlist IPs | `<fill>` |
| Repository mode (enterprise/community) | `<fill>` |
| Named admins + assigned roles | `<fill>` |
| SSH policy settings | `<fill>` |
| NTP source | `<fill>` |
| Backup location and retention | `<fill>` |
